# Story 4.5: Audio Feedback System

## Status

**Draft**

## Story

**As a** child,
**I want** fun sounds when I select videos,
**so that** the experience feels playful and responsive.

## Acceptance Criteria

1. Playful "pop" sound on thumbnail click
2. Gentle transition sound when returning to grid
3. Pleasant chime for warnings (not jarring)
4. Parent setting to enable/disable all sounds
5. Volume controls in parent interface
6. Sounds load quickly and don't delay interactions
7. All audio files optimized for web (small file size, <100KB each)
8. Sounds appropriate for young children (no scary or harsh sounds)
9. Fallback: application works perfectly without audio
10. Audio files stored in frontend/public/sounds/ directory

## Tasks / Subtasks

- [ ] **Task 1: Source and optimize audio files** (AC: 7, 8, 10)
  - [ ] Find 4 child-appropriate sounds from free libraries (freesound.org, zapsplat.com - CC0/public domain)
    - [ ] Playful "pop" sound for thumbnail click (0.2s duration, bouncy character)
    - [ ] Gentle transition sound for grid return (0.3-0.5s duration, soft/reassuring)
    - [ ] Pleasant warning chime (0.5-1.0s duration, gentle bell/marimba, not jarring)
    - [ ] Gentle grace notification sound (for grace video feature from Story 4.3)
  - [ ] Optimize all audio files to meet web requirements
    - [ ] Convert to MP3 format (best browser compatibility)
    - [ ] Reduce to mono channel (smaller file size)
    - [ ] Set bitrate to 128kbps (good quality, reasonable size)
    - [ ] Verify each file is <100KB
  - [ ] Place all audio files in `frontend/public/sounds/` directory
    - [ ] `click.mp3`
    - [ ] `transition.mp3`
    - [ ] `warning-chime.mp3`
    - [ ] `grace-notification.mp3`

- [ ] **Task 2: Implement audio-manager.js core functionality** (AC: 1, 2, 3, 6, 9)
  - [ ] Create audio preloading system (non-blocking, on page load)
    - [ ] Initialize audioCache object with 4 Audio elements
    - [ ] Call `.load()` on all audio files during page initialization
    - [ ] Ensure preloading doesn't block UI rendering (async)
  - [ ] Implement `playClickSound()` function
    - [ ] Check if audio enabled via `isAudioEnabled()`
    - [ ] Clone audio node (allows overlapping sounds)
    - [ ] Apply current volume setting
    - [ ] Play with `.catch()` error handling (AC 9: graceful fallback)
  - [ ] Implement `playTransitionSound()` function
    - [ ] Same pattern as playClickSound
    - [ ] Use transition.mp3 from cache
  - [ ] Implement `playWarningChime(warningType)` function (AC 3)
    - [ ] Already called by warning-display.js (line 17) - no changes needed there
    - [ ] Use warning-chime.mp3 from cache
    - [ ] Support warningType parameter (10min, 5min, 2min) - same sound for all
  - [ ] Implement `playGraceNotification()` function
    - [ ] Already called by grace flow from Story 4.3
    - [ ] Use grace-notification.mp3 from cache
  - [ ] Implement `getVolumeFromSettings()` helper function
    - [ ] Fetch volume from backend settings (0.0-1.0 range)
    - [ ] Cache volume value locally in module scope
    - [ ] Default to 0.7 (70%) if setting not found
  - [ ] Update `isAudioEnabled()` stub to fetch from backend
    - [ ] Call GET /admin/settings endpoint
    - [ ] Return audioEnabled boolean
    - [ ] Cache result to avoid repeated API calls
  - [ ] Update `setAudioEnabled(enabled)` stub
    - [ ] Call POST /admin/settings with audioEnabled value
    - [ ] Update local cache
  - [ ] Add comprehensive error handling throughout (AC 9)
    - [ ] Wrap all audio operations in try-catch
    - [ ] Use `.catch()` on all `.play()` promises (autoplay policies)
    - [ ] Log warnings to console, never throw errors to user
    - [ ] Ensure application works perfectly if audio fails

- [ ] **Task 3: Add volume control to admin settings** (AC: 4, 5)
  - [ ] Update database schema (backend/db/schema.sql)
    - [ ] Add `audio_volume` setting with default '0.7' (70%)
    - [ ] Note: `audio_enabled` already exists (line 194)
  - [ ] Update settings API endpoint (backend/routes.py)
    - [ ] Modify GET /admin/settings to include audioVolume
    - [ ] Modify POST /admin/settings to accept audioVolume (validate 0.0-1.0 range)
    - [ ] Use SQL placeholders (TIER 1 Rule 5: validate parent inputs)
  - [ ] Update admin settings template (frontend/templates/admin/settings.html)
    - [ ] Add audio section with Norwegian labels
    - [ ] Add checkbox for "Aktiver lyder" (Enable sounds) - maps to audio_enabled
    - [ ] Add range slider (0-100) for "Lydvolum" (Volume)
    - [ ] Add volume percentage display "Volum: 70%"
    - [ ] Include aria-label attributes for accessibility
  - [ ] Update settings.js (frontend/src/admin/settings.js)
    - [ ] Add handler for volume slider change event
    - [ ] Convert slider value (0-100) to volume (0.0-1.0)
    - [ ] Call API to save volume setting
    - [ ] Update volume percentage display in real-time
    - [ ] Show Norwegian success message: "Innstillinger lagret"
    - [ ] Handle errors with Norwegian messages

- [ ] **Task 4: Integrate audio into UI flows** (AC: 1, 2)
  - [ ] Add click sound to video grid thumbnails (AC 1)
    - [ ] Locate video grid rendering code (likely frontend/src/child/grid.js or child.js)
    - [ ] Import playClickSound from audio-manager.js
    - [ ] Attach click event listener to each thumbnail card
    - [ ] Call playClickSound() on click (before video navigation)
  - [ ] Add transition sound to player return flow (AC 2)
    - [ ] Locate player return/back navigation code
    - [ ] Import playTransitionSound from audio-manager.js
    - [ ] Call playTransitionSound() when returning to grid (ESC key or back button)
  - [ ] Verify grace notification integration
    - [ ] Check that grace flow already calls playGraceNotification()
    - [ ] No code changes needed (stub already integrated in Story 4.3)

- [ ] **Task 5: Write comprehensive tests**
  - [ ] Create frontend/src/child/audio-manager.test.js
    - [ ] Test: plays click sound when audio enabled
    - [ ] Test: does not play sound when audio disabled
    - [ ] Test: applies volume setting when playing sound
    - [ ] Test: handles audio loading failure gracefully (AC 9)
    - [ ] Test: preloads sounds without blocking page load (AC 6)
    - [ ] Test: clones audio for overlapping playback
    - [ ] Test: all 4 sound functions (click, transition, warning, grace)
  - [ ] Extend frontend/src/admin/settings.test.js
    - [ ] Test: updates audio enabled setting
    - [ ] Test: updates volume setting
    - [ ] Test: validates volume range (0-100)
    - [ ] Test: shows Norwegian labels for audio controls
  - [ ] Create tests/e2e/specs/audio-feedback.spec.js
    - [ ] Test: plays click sound on thumbnail click (verify audio element interaction)
    - [ ] Test: plays warning chime on time limit warning
    - [ ] Test: respects audio enabled setting (disabled = no sounds)
  - [ ] Run all tests and verify coverage ≥70% for audio-manager.js
  - [ ] Run npm run test and npm run test:coverage

- [ ] **Task 6: Validate all acceptance criteria met**
  - [ ] AC 1: Verify playful "pop" sound on thumbnail click works
  - [ ] AC 2: Verify gentle transition sound on grid return works
  - [ ] AC 3: Verify pleasant warning chime (not jarring)
  - [ ] AC 4: Verify parent can enable/disable all sounds via settings
  - [ ] AC 5: Verify volume control slider works in admin interface
  - [ ] AC 6: Verify sounds load quickly without delaying interactions
  - [ ] AC 7: Verify all audio files are <100KB each
  - [ ] AC 8: Verify sounds are appropriate for young children (test with actual audio)
  - [ ] AC 9: Test application works perfectly when audio fails (disable audio, block autoplay)
  - [ ] AC 10: Verify all audio files are in frontend/public/sounds/

## Dev Notes

### Previous Story Insights

**From Story 4.4 Completion (Dev Agent Record):**
- All 35 tests completed in 1.34s (excellent performance baseline)
- Established pattern: TIER 1 tests use `@pytest.mark.tier1` decorator
- Frontend tests use happy-dom with fetch API mocking
- E2E tests use Playwright with chromium
- Outstanding code documentation maintained (comprehensive docstrings expected)
- Perfect TIER 1/2/3 coding standards compliance maintained
- No technical debt identified in previous story

**Key Integration Point:**
- Story 4.3 (Grace Video) already integrated grace flow with audio stub
- Story 4.2 (Warning Display) already calls `playWarningChime()` in warning-display.js:17
- **No changes needed** to warning-display.js or grace flow code
- Only need to implement the stubs in audio-manager.js

### Data Models

**Settings Table (Existing):**
[Source: backend/db/schema.sql#L194]
```sql
-- Existing setting (already in database):
('audio_enabled', 'true', datetime('now'))

-- New setting to add for Story 4.5:
('audio_volume', '0.7', datetime('now'))  -- Default 70% volume
```

**Audio Setting Fields:**
- `audio_enabled`: BOOLEAN stored as TEXT ('true'/'false') - already exists
- `audio_volume`: FLOAT stored as TEXT ('0.0'-'1.0') - needs to be added
- Both settings accessed via existing GET/POST /admin/settings endpoints

**Volume Range:**
- Backend storage: 0.0 to 1.0 (float)
- Frontend UI: 0 to 100 (integer slider)
- Conversion: `volume = sliderValue / 100`

### API Specifications

**Existing Settings Endpoints:**
[Source: docs/architecture/rest-api-spec.md#settings-endpoints]

**GET /admin/settings**
- Already implemented in previous stories
- Returns all settings including audio_enabled
- Need to extend response to include audioVolume

Request: `GET /admin/settings`

Response:
```json
{
  "success": true,
  "settings": {
    "dailyLimitMinutes": 30,
    "gridSize": 9,
    "audioEnabled": true,
    "audioVolume": 0.7
  }
}
```

**POST /admin/settings**
- Already implemented in previous stories
- Accepts partial settings updates
- Need to add validation for audioVolume (0.0-1.0 range)

Request:
```json
{
  "audioEnabled": true,
  "audioVolume": 0.7
}
```

Response:
```json
{
  "success": true,
  "message": "Innstillinger lagret"
}
```

**Error Responses:**
```json
{
  "error": "InvalidVolume",
  "message": "Ugyldig volumnivå (0.0-1.0)"
}
```

**TIER 1 Rule 5 Application:**
[Source: docs/architecture/coding-standards.md#tier-1-rules]
- Validate audioVolume range (must be 0.0 ≤ volume ≤ 1.0)
- Use SQL placeholders for all queries (never string formatting)
- Sanitize all parent inputs in settings endpoint

### Component Specifications

**Frontend Component: audio-manager.js**
[Source: docs/architecture/components.md#frontend-components]

**Current Status:** Stub exists (Story 4.2) with 5 functions:
- File location: `frontend/src/child/audio-manager.js`
- Already imported by: `frontend/src/child/warning-display.js:17`
- Already integrated in grace flow (Story 4.3)

**Functions to Implement:**

1. **playClickSound()** - AC 1
   ```javascript
   export function playClickSound() {
     if (!isAudioEnabled()) return;
     try {
       const sound = audioCache.click.cloneNode();
       sound.volume = getVolumeFromSettings();
       sound.play().catch(err => {
         console.warn('[Audio] Failed to play click sound:', err);
         // AC 9: Application works perfectly without audio
       });
     } catch (err) {
       console.error('[Audio] Unexpected audio error:', err);
     }
   }
   ```

2. **playTransitionSound()** - AC 2
   - Same pattern as playClickSound, use transition.mp3

3. **playWarningChime(warningType)** - AC 3
   - Accept warningType: '10min', '5min', '2min' (for logging/future use)
   - Use same warning-chime.mp3 for all types (gentle, not jarring)

4. **playGraceNotification()** - Grace video feature
   - Use grace-notification.mp3
   - Called when grace screen appears

5. **isAudioEnabled()** - AC 4
   - Currently returns hardcoded `true`
   - Update to fetch from backend settings
   - Cache result to avoid repeated API calls

**Audio Preloading Pattern:**
[Source: docs/architecture/frontend-architecture.md#resource-loading]

```javascript
// Module-scoped cache for preloaded audio
const audioCache = {
  click: new Audio('/sounds/click.mp3'),
  transition: new Audio('/sounds/transition.mp3'),
  warningChime: new Audio('/sounds/warning-chime.mp3'),
  graceNotification: new Audio('/sounds/grace-notification.mp3')
};

// Preload all sounds on module initialization (AC 6: don't delay interactions)
Object.values(audioCache).forEach(audio => {
  audio.load();  // Non-blocking async preload
  audio.volume = 0.7;  // Default volume, will be updated from settings
});
```

**Why Clone Audio Nodes:**
- Allows overlapping playback (user clicks multiple thumbnails rapidly)
- Original cached audio stays preloaded
- Each clone is independent

**Browser Autoplay Policy Handling:**
[Source: docs/architecture/frontend-architecture.md#browser-apis]
- Modern browsers block autoplay without user interaction
- `.play()` returns a Promise that may reject
- Must use `.catch()` to handle rejections gracefully (AC 9)
- Console warnings acceptable, but never break application

### File Locations

**Files to Create:**
[Source: docs/architecture/source-tree.md]

```
frontend/public/sounds/
├── click.mp3              # NEW - Thumbnail click sound (<100KB)
├── transition.mp3         # NEW - Grid return sound (<100KB)
├── warning-chime.mp3      # NEW - Warning sound (<100KB)
└── grace-notification.mp3 # NEW - Grace video sound (<100KB)

frontend/src/child/
└── audio-manager.test.js  # NEW - Unit tests for audio-manager.js

tests/e2e/specs/
└── audio-feedback.spec.js # NEW - E2E tests for audio interactions
```

**Files to Modify:**
```
backend/db/schema.sql                     # Add audio_volume setting
backend/routes.py                         # Extend settings endpoint for volume
frontend/src/child/audio-manager.js       # Implement 5 stub functions
frontend/src/child/grid.js                # Add click sound to thumbnails
frontend/src/child/player.js              # Add transition sound to back nav
frontend/src/admin/settings.js            # Add volume control handlers
frontend/src/admin/settings.test.js       # Add audio settings tests
frontend/templates/admin/settings.html    # Add volume slider UI
```

**Files Already Integrated (No Changes Needed):**
```
frontend/src/child/warning-display.js     # Already calls playWarningChime():17
[Grace flow files]                        # Already call playGraceNotification()
```

### Testing Standards

[Source: docs/architecture/testing-strategy.md]

**Frontend Testing Framework:**
- **Tool:** Vitest 3.2.4 with happy-dom 19.0.2
- **Location:** Tests collocated with source
- **Coverage:** @vitest/coverage-v8 3.2.4
- **Target:** 70%+ coverage acceptable for UI components
- **Test File:** `frontend/src/child/audio-manager.test.js` (create next to audio-manager.js)

**Test Structure Pattern:**
```javascript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import {
  playClickSound,
  playWarningChime,
  isAudioEnabled
} from './audio-manager.js';

describe('audio-manager', () => {
  beforeEach(() => {
    // Reset module state between tests
    vi.clearAllMocks();
  });

  it('plays click sound when audio enabled', () => {
    // Arrange: Mock audio enabled
    // Act: Call playClickSound()
    // Assert: Verify audio.play() called
  });

  it('does not play sound when audio disabled', () => {
    // Arrange: Mock audio disabled
    // Act: Call playClickSound()
    // Assert: Verify audio.play() NOT called
  });

  it('handles audio loading failure gracefully (AC 9)', () => {
    // Arrange: Mock audio.play() rejection
    // Act: Call playClickSound()
    // Assert: No errors thrown, console.warn called
  });
});
```

**E2E Testing Framework:**
- **Tool:** Playwright 1.40.0
- **Browser:** Chromium
- **Location:** `tests/e2e/specs/audio-feedback.spec.js`

**E2E Test Pattern:**
```javascript
import { test, expect } from '@playwright/test';

test.describe('Audio Feedback', () => {
  test('plays click sound on thumbnail click', async ({ page }) => {
    await page.goto('/');

    // Listen for audio play events
    const audioPlayed = page.evaluate(() => {
      return new Promise((resolve) => {
        document.addEventListener('play', () => resolve(true), { once: true });
        setTimeout(() => resolve(false), 1000);
      });
    });

    // Click thumbnail
    await page.click('[data-video-id]');

    // Verify audio played
    expect(await audioPlayed).toBe(true);
  });
});
```

**Running Tests:**
```bash
# Frontend unit tests
npm test

# Frontend with coverage
npm run test:coverage

# E2E tests
npm run test:e2e

# All tests
npm test && npm run test:e2e
```

### Technical Constraints

**Audio Format Requirements:**
[Source: docs/architecture/tech-stack.md#audio-support]
- **Format:** MP3 (99%+ browser support, best compatibility)
- **File Size:** <100KB each (AC 7)
- **Bitrate:** 128kbps (good quality, reasonable size)
- **Channels:** Mono (smaller than stereo, adequate for UI sounds)
- **Sample Rate:** 44.1kHz or 48kHz (standard)

**Optimization Workflow:**
1. Source WAV/FLAC from free libraries (uncompressed)
2. Convert to mono: `ffmpeg -i input.wav -ac 1 mono.wav`
3. Convert to MP3: `ffmpeg -i mono.wav -b:a 128k output.mp3`
4. Verify size: `ls -lh output.mp3` (must be <100KB)
5. Test in browser: Ensure playback works across browsers

**Browser Compatibility:**
[Source: docs/architecture/frontend-architecture.md#browser-support]
- **Target:** Modern browsers (Chrome 90+, Firefox 88+, Safari 14+)
- **Audio API:** HTML5 Audio element (widely supported)
- **Autoplay:** May be blocked without user interaction (handle with .catch())

**Performance Considerations:**
[Source: docs/architecture/frontend-architecture.md#performance]
- **Preload Strategy:** Async load on page initialization (AC 6)
- **Non-Blocking:** Audio preloading must not delay UI rendering
- **Memory:** 4 audio files × ~50KB = ~200KB total (acceptable)
- **Network:** Cached after first load (standard browser caching)

**Error Handling Requirements (TIER 2 Rule 9):**
[Source: docs/architecture/coding-standards.md#tier-2-rules]
- **Comprehensive error handling for all frontend API calls**
- **Audio loading failures must not break application (AC 9)**
- **Use try-catch for synchronous errors**
- **Use .catch() for Promise rejections**
- **Log warnings to console (useful for debugging)**
- **Never throw errors to user for audio failures**

**Graceful Degradation Strategy (AC 9):**
1. If audio files fail to load → application works without sound
2. If autoplay blocked by browser → no error shown to user
3. If Audio API not supported (rare) → feature silently disabled
4. If volume setting fetch fails → default to 0.7 (70%)
5. If audio_enabled setting fetch fails → default to enabled

### Norwegian UI Messages (TIER 3 Rule 14)

[Source: docs/architecture/coding-standards.md#tier-3-rules]

**Admin Settings Labels (frontend/templates/admin/settings.html):**
- Audio enabled checkbox: "Aktiver lyder"
- Volume slider label: "Lydvolum"
- Volume percentage display: "Volum: {{percentage}}%"
- Settings section heading: "Lydinnstillinger" (Audio Settings)

**Success Messages (frontend/src/admin/settings.js):**
- Settings saved: "Innstillinger lagret"

**Error Messages (backend/routes.py, frontend error handlers):**
- Audio load failed: "Kunne ikke laste lydfiler"
- Invalid volume: "Ugyldig volumnivå (0.0-1.0)"
- Settings save failed: "Kunne ikke lagre innstillinger"

**Console Messages (English - for debugging):**
- `console.warn('[Audio] Failed to play click sound:', err)`
- `console.warn('[Audio] Autoplay blocked or sound failed:', err)`
- `console.error('[Audio] Unexpected audio error:', err)`

### Audio File Sourcing Guide

**Recommended Free Sound Libraries:**
- **Freesound.org** - Search filters: CC0 license, <100KB size
- **Zapsplat.com** - Free section with child-friendly UI sounds
- **Public Domain:** Sounds marked "Public Domain" or "CC0"

**Search Terms:**
- Click sound: "pop", "bubble", "soft click", "UI click", "cartoon pop"
- Transition: "whoosh", "soft chime", "gentle transition", "page turn"
- Warning chime: "bell", "marimba", "gentle chime", "soft ding", "notification"
- Grace notification: "peaceful chime", "angel sound", "harp", "gentle bell"

**Child-Appropriate Criteria (AC 8):**
- ✅ Soft, rounded tones (bubbles, chimes, bells)
- ✅ Playful, bouncy sounds (cartoon-like)
- ✅ Gentle, reassuring sounds (not startling)
- ❌ Harsh, sharp sounds (buzzes, alarms, beeps)
- ❌ Scary sounds (crashes, screams, thunder)
- ❌ Aggressive sounds (explosions, gunshots)

**Quality Check Before Integration:**
1. Play sound at 70% volume (typical setting)
2. Verify it's pleasant for a 2-6 year old child
3. Check it's not jarring or startling (especially warning chime)
4. Ensure duration is appropriate (<1 second for click/warning)

### Integration Notes

**Existing Code Already Calling Audio Functions:**

1. **Warning Display (Story 4.2):**
   - File: `frontend/src/child/warning-display.js:17`
   - Calls: `playWarningChime(warningType)`
   - Action: No changes needed, just implement the stub

2. **Grace Video Flow (Story 4.3):**
   - Location: Grace flow code (exact file TBD during implementation)
   - Calls: `playGraceNotification()`
   - Action: No changes needed, just implement the stub

3. **Video Grid (To be integrated in this story):**
   - File: `frontend/src/child/grid.js` or thumbnail rendering code
   - Action: Add `playClickSound()` call on thumbnail click event
   - Integration point: Click event handler for `.video-card` elements

4. **Player Return (To be integrated in this story):**
   - File: `frontend/src/child/player.js` or navigation code
   - Action: Add `playTransitionSound()` call on back/ESC navigation
   - Integration point: Return to grid handler

### Project Structure Alignment

[Source: docs/architecture/unified-project-structure.md]

**Frontend Module Organization:**
- ✅ `frontend/src/child/audio-manager.js` - Correct location for child UI modules
- ✅ `frontend/src/admin/settings.js` - Correct location for admin modules
- ✅ `frontend/public/sounds/` - Correct location for static assets
- ✅ Tests collocated with source - Follows established pattern

**Backend Organization:**
- ✅ `backend/db/schema.sql` - Correct location for schema changes
- ✅ `backend/routes.py` - Single routes file pattern (don't split)
- ✅ Settings managed via existing settings table (no new tables needed)

**No structural conflicts identified.**

## Testing

### Test File Locations

- **Unit Tests:** `frontend/src/child/audio-manager.test.js` (collocated with source)
- **Integration Tests:** `frontend/src/admin/settings.test.js` (extend existing)
- **E2E Tests:** `tests/e2e/specs/audio-feedback.spec.js`

### Testing Frameworks

[Source: docs/architecture/testing-strategy.md]

- **Frontend Unit:** Vitest 3.2.4 with happy-dom 19.0.2
- **Frontend Integration:** Vitest 3.2.4 with fetch mocking
- **E2E:** Playwright 1.40.0 (chromium)
- **Coverage:** @vitest/coverage-v8 3.2.4

### Coverage Targets

- **UI Components (audio-manager.js):** 70%+ coverage acceptable
- **Business Logic (settings.js):** 90%+ coverage target
- **Overall Frontend:** 70%+ acceptable for this story

### Test Execution Commands

```bash
# Run frontend unit tests
npm test

# Run with coverage report
npm run test:coverage

# Run E2E tests
npm run test:e2e

# Run all tests
npm test && npm run test:e2e
```

### Test Structure Standards

[Source: docs/architecture/testing-strategy.md#test-structure]

**AAA Pattern (Arrange-Act-Assert):**
```javascript
it('plays click sound when audio enabled', () => {
  // Arrange
  const mockAudio = { play: vi.fn().mockResolvedValue(undefined) };

  // Act
  playClickSound();

  // Assert
  expect(mockAudio.play).toHaveBeenCalled();
});
```

**Test Naming Convention:**
- `test_<function>_<scenario>()`
- Example: `test_playClickSound_whenAudioEnabled()`

**Test Organization:**
- Group related tests in `describe()` blocks
- Use `beforeEach()` for setup, `afterEach()` for cleanup
- Mock external dependencies (fetch API, Audio elements)

### Specific Test Cases Required

**audio-manager.test.js (7 test cases minimum):**
1. ✅ Plays click sound when audio enabled
2. ✅ Does not play sound when audio disabled
3. ✅ Applies volume setting when playing sound
4. ✅ Handles audio loading failure gracefully (AC 9)
5. ✅ Preloads sounds without blocking page load (AC 6)
6. ✅ Clones audio for overlapping playback
7. ✅ All 4 sound functions work (click, transition, warning, grace)

**settings.test.js (4 new test cases):**
1. ✅ Updates audio enabled setting
2. ✅ Updates volume setting
3. ✅ Validates volume range (0-100 in UI, 0.0-1.0 in backend)
4. ✅ Shows Norwegian labels for audio controls

**audio-feedback.spec.js (3 E2E test cases):**
1. ✅ Plays click sound on thumbnail click
2. ✅ Plays warning chime on time limit warning
3. ✅ Respects audio enabled setting (disabled = no sounds)

### TIER 1 Safety Tests

[Source: docs/architecture/testing-strategy.md#tier-1-safety-tests]

**Note:** No TIER 1 safety tests required for this story.
- Audio is a non-critical enhancement feature
- AC 9 requires graceful fallback (application works without audio)
- No child safety rules apply to audio feedback
- Input validation for volume setting is TIER 2 (not safety-critical)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-04 | 1.0 | Initial story creation for Epic 4, Story 5 | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

### Agent Model Used

*[To be filled by dev agent]*

### Debug Log References

*[To be filled by dev agent]*

### Completion Notes

*[To be filled by dev agent]*

### File List

*[To be filled by dev agent]*

## QA Results

*This section will be populated by the QA agent after story completion.*
