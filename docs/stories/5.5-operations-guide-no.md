# Story 5.5: Parent Operations Guide (Norwegian)

## Status
Ready for Review

## Dependencies

**Prerequisite Stories:**
- **Story 5.4 (Monitoring & Maintenance Setup)** - MUST be completed first
  - Monitoring scripts (check-health.sh, dashboard.sh) must exist
  - Backup/restore scripts must be functional
  - Norwegian output patterns established

## Story

**As a** parent operating the application,
**I want** a simplified operations guide in Norwegian,
**so that** I can maintain and troubleshoot the system independently.

## Acceptance Criteria

1. Operations guide created at `docs/operations-guide-no.md` in Norwegian
2. Guide includes step-by-step deployment procedure with exact commands
3. Guide includes backup and restore procedures with verification steps
4. Guide documents restore verification: `PRAGMA integrity_check` must return OK
5. Guide includes log viewing instructions with journalctl commands explained in Norwegian
6. Guide documents session behavior: "√òkter nullstilles ved omstart - du m√• logge inn p√• nytt"
7. Guide includes common troubleshooting scenarios with Norwegian solutions
8. Guide includes weekly maintenance checklist in Norwegian: sjekk helse, verifiser backup, sjekk diskplass, se feillogger
9. Guide includes monthly maintenance checklist in Norwegian: verifiser SSL-sertifikat, kj√∏r restore-test, oppdater system
10. Guide written in clear, non-technical Norwegian (no technical jargon)
11. Guide includes screenshots or command examples for each procedure
12. Guide covers: starting/stopping service, viewing logs, restoring from backup, password reset
13. Guide documents bcrypt password reset procedure
14. Guide references monitoring scripts: check-health.sh, dashboard.sh with Norwegian explanations
15. Guide includes journalctl examples: `journalctl -u youtube-viewer.service -n 50` (vis siste 50 linjer)
16. Guide documents systemctl commands: start, stop, restart, status with Norwegian explanations
17. Guide includes troubleshooting section: "Tjenesten starter ikke", "Ingen videoer vises", "Kan ikke logge inn"
18. Guide accessible from admin interface (link to documentation)
19. Guide includes emergency contacts/procedures section
20. Guide formatted for easy printing (A4, readable font size)

## Tasks / Subtasks

### Phase 1: Document Structure & Core Operations (AC: 1, 10, 11, 12, 20)

- [x] **Task 1: Create operations guide structure** (AC: 1, 10, 20)
  - [x] Create `docs/operations-guide-no.md` in project root
  - [x] Write introduction section in Norwegian explaining purpose
  - [x] Structure document with clear sections and headings
  - [x] Use clear, non-technical Norwegian language (avoid jargon)
  - [x] Format for A4 printing with readable font sizes
  - [x] Add table of contents with Norwegian section names

- [x] **Task 2: Document service management operations** (AC: 12, 16)
  - [x] Starting service section: `sudo systemctl start youtube-viewer.service`
  - [x] Stopping service section: `sudo systemctl stop youtube-viewer.service`
  - [x] Restarting service section: `sudo systemctl restart youtube-viewer.service`
  - [x] Checking service status: `sudo systemctl status youtube-viewer.service`
  - [x] Norwegian explanations for each systemctl command
  - [x] Include command examples with expected output (AC: 11)
  - [x] Explain "active (running)" vs "inactive (dead)" states in Norwegian

- [x] **Task 3: Document log viewing procedures** (AC: 5, 15)
  - [x] Basic log viewing: `journalctl -u youtube-viewer.service -n 50`
  - [x] Norwegian explanation: "vis siste 50 linjer" (show last 50 lines)
  - [x] Follow live logs: `journalctl -u youtube-viewer.service -f`
  - [x] Norwegian explanation: "f√∏lg nye meldinger i sanntid" (follow new messages in real-time)
  - [x] View logs by date: `journalctl -u youtube-viewer.service --since "2025-11-01"`
  - [x] Filter error logs: `journalctl -u youtube-viewer.service | grep ERROR`
  - [x] Include example log output with Norwegian annotations

### Phase 2: Backup & Restore Procedures (AC: 3, 4, 13)

- [x] **Task 4: Document backup procedures** (AC: 3)
  - [x] Manual backup section: `cd /opt/youtube-viewer/app && ./scripts/backup.sh`
  - [x] Norwegian explanation of backup process
  - [x] Explain backup filename format: `app-YYYYMMDD-HHMMSS.db`
  - [x] Document backup location: `/opt/youtube-viewer/backups/`
  - [x] List backups command: `ls -lht /opt/youtube-viewer/backups/`
  - [x] Automated daily backups at 2 AM UTC (explain systemd timer)
  - [x] Backup retention: 7 days automatic cleanup
  - [x] Include command examples (AC: 11)

- [x] **Task 5: Document restore procedures with verification** (AC: 3, 4)
  - [x] List available backups command with Norwegian explanation
  - [x] Restore command: `sudo ./scripts/restore.sh app-YYYYMMDD-HHMMSS.db`
  - [x] Step-by-step restore process in Norwegian:
    1. Service stops automatically (tjenesten stoppes automatisk)
    2. Current database backed up (n√•v√¶rende database sikkerhetskoperes)
    3. Backup restored (backup gjenopprettes)
    4. Integrity check runs (integritetskontroll kj√∏res)
    5. Service restarts (tjenesten startes p√• nytt)
  - [x] Document verification step: `PRAGMA integrity_check` must return OK (AC: 4)
  - [x] Explain rollback if integrity check fails (Norwegian)
  - [x] Include example command output with Norwegian annotations

- [x] **Task 6: Document password reset procedure** (AC: 12, 13)
  - [x] Stop service first: `sudo systemctl stop youtube-viewer.service`
  - [x] Run password reset: `cd /opt/youtube-viewer/app && uv run python backend/db/init_db.py <nytt_passord>`
  - [x] Norwegian explanation: "Bytt <nytt_passord> med ditt valgte passord"
  - [x] Explain bcrypt hashing happens automatically (AC: 13)
  - [x] Document password requirements (if any)
  - [x] Start service after reset: `sudo systemctl start youtube-viewer.service`
  - [x] Verification: Log in to admin interface with new password
  - [x] Document session behavior: "√òkter nullstilles ved omstart - du m√• logge inn p√• nytt" (AC: 6)

### Phase 3: Monitoring & Maintenance (AC: 8, 9, 14)

- [x] **Task 7: Document weekly maintenance checklist** (AC: 8, 14)
  - [x] Create "Ukentlig vedlikehold" (Weekly Maintenance) section
  - [x] Checklist item 1: Kj√∏r helsekontroll (Run health check)
    - [x] Command: `cd /opt/youtube-viewer/app && ./scripts/check-health.sh`
    - [x] Norwegian explanation of health check script output
    - [x] Reference check-health.sh monitoring script (AC: 14)
  - [x] Checklist item 2: Verifiser backup finnes (Verify backups exist)
    - [x] Command: `ls -lht /opt/youtube-viewer/backups/ | head -8`
    - [x] Norwegian explanation: Check that 7 days of backups are present
  - [x] Checklist item 3: Sjekk diskplass (Check disk space)
    - [x] Command: `df -h /opt/youtube-viewer`
    - [x] Norwegian explanation: Ensure >20% free space
  - [x] Checklist item 4: Se gjennom feillogger (Review error logs)
    - [x] Command: `journalctl -u youtube-viewer.service --since "7 days ago" | grep ERROR`
    - [x] Norwegian explanation: Look for repeated errors or unusual patterns

- [x] **Task 8: Document monthly maintenance checklist** (AC: 9)
  - [x] Create "M√•nedlig vedlikehold" (Monthly Maintenance) section
  - [x] Checklist item 1: Verifiser SSL-sertifikat (Verify SSL certificate)
    - [x] Command: `sudo certbot certificates`
    - [x] Norwegian explanation: Check expiry date, auto-renewal should keep it valid
  - [x] Checklist item 2: Kj√∏r restore-test (Run restore test)
    - [x] Create test database backup
    - [x] Test restore procedure with verification
    - [x] Norwegian step-by-step instructions
    - [x] Restore production database after test
  - [x] Checklist item 3: Oppdater system (Update system)
    - [x] Command: `sudo apt update && sudo apt upgrade`
    - [x] Norwegian explanation: System security updates
    - [x] Note: Reboot if kernel updated

- [x] **Task 9: Document monitoring scripts reference** (AC: 14)
  - [x] Dashboard script section: `./scripts/dashboard.sh`
  - [x] Norwegian explanation of dashboard output:
    - [x] Tjeneste status (Service status)
    - [x] Ressurser (Resources: CPU, memory, disk)
    - [x] I dag aktivitet (Today's activity: videos watched, minutes)
    - [x] Siste feil (Recent errors)
  - [x] Explain when to use dashboard vs check-health
  - [x] Include example output with Norwegian annotations

### Phase 4: Deployment & Troubleshooting (AC: 2, 7, 17)

- [x] **Task 10: Document deployment procedure** (AC: 2)
  - [x] Deployment section: "Oppdatering av applikasjonen"
  - [x] Pre-deployment backup recommendation (Norwegian)
  - [x] Deployment command: `cd /opt/youtube-viewer/app && ./scripts/deploy.sh`
  - [x] Step-by-step deployment process in Norwegian:
    1. Code update from repository (kode oppdateres fra repository)
    2. Quality checks run (kvalitetskontroller kj√∏res)
    3. Tests run (tester kj√∏res)
    4. Frontend builds (frontend bygges)
    5. Service restarts (tjenesten startes p√• nytt)
    6. Health check verifies (helsekontroll verifiserer)
  - [x] Explain automatic rollback on failure (Norwegian)
  - [x] View deployment log: `tail -f /opt/youtube-viewer/logs/deployments.log`
  - [x] Include command examples with expected output (AC: 11)

- [x] **Task 11: Document common troubleshooting scenarios** (AC: 7, 17)
  - [x] Troubleshooting section: "Feils√∏king" (Troubleshooting)
  - [x] Scenario 1: "Tjenesten starter ikke" (Service won't start) (AC: 17)
    - [x] Check service status: `sudo systemctl status youtube-viewer.service`
    - [x] View recent logs: `journalctl -u youtube-viewer.service -n 50`
    - [x] Common causes in Norwegian: database permissions, missing environment variables, port in use
    - [x] Solutions with commands
  - [x] Scenario 2: "Ingen videoer vises" (No videos displayed) (AC: 17)
    - [x] Check if channels added via admin interface
    - [x] Verify YouTube API key in .env file
    - [x] Check application logs for API errors
    - [x] Solutions in Norwegian
  - [x] Scenario 3: "Kan ikke logge inn" (Cannot log in) (AC: 17)
    - [x] Verify correct password
    - [x] Check if sessions reset after restart (reference AC: 6)
    - [x] Password reset procedure (reference Task 6)
    - [x] Solutions in Norwegian
  - [x] Additional scenarios:
    - [x] "Backup feiler" (Backup fails)
    - [x] "Lav diskplass" (Low disk space)
    - [x] "Database feil" (Database errors)

### Phase 5: Admin Interface Integration & Emergency Procedures (AC: 18, 19)

- [x] **Task 12: Add documentation link in admin dashboard** (AC: 18)
  - [x] Open `frontend/templates/admin/dashboard.html`
  - [x] Locate navigation section (existing links: Kanaler, Historikk, Innstillinger)
  - [x] Add documentation link after settings link:
        `<a href="/docs/operations-guide-no.md" target="_blank">Driftsh√•ndbok</a>`
  - [x] Test link opens operations guide in new tab from admin interface
  - [x] Verify guide is accessible without authentication errors

- [x] **Task 13: Document emergency procedures and contacts** (AC: 19)
  - [x] Emergency contacts section: "N√∏dkontakter" (Emergency Contacts)
  - [x] Add contact information fields with placeholder format:
    - [x] **Teknisk support**: [Navn/epost/telefon - fyll inn]
    - [x] **Hetzner support**: https://console.hetzner.cloud/support
    - [x] **N√∏dkontakt**: [Navn/telefon - fyll inn]
  - [x] Add note: "Fyll inn kontaktinformasjon i feltene merket [fyll inn]"
  - [x] Emergency procedures section:
    - [x] System completely down: Check Hetzner server status, verify SSH access
    - [x] Database corruption: Immediate restore from backup procedure
    - [x] Security incident: Stop service, review logs, contact support
    - [x] Disk full: Emergency cleanup steps, backup retention adjustment
  - [x] All emergency procedures in clear Norwegian
  - [x] Include "When to call for help" guidance (Norwegian)

### Phase 6: Review & Testing

- [x] **Task 14: Content review and validation**
  - [x] Review all Norwegian text for clarity and correctness
  - [x] Verify no technical jargon in parent-facing sections (AC: 10)
  - [x] Check that all 20 ACs are addressed in document
  - [x] Verify all command examples are accurate
  - [x] Test all commands on actual system
  - [x] Ensure formatting is suitable for A4 printing (AC: 20)

- [x] **Task 15: Test guide usability**
  - [x] Walk through deployment procedure following guide
  - [x] Test backup and restore procedures step-by-step
  - [x] Verify weekly maintenance checklist is comprehensive
  - [x] Test troubleshooting scenarios cover common issues
  - [x] Verify monitoring scripts work as documented
  - [x] Confirm emergency procedures are clear

## Dev Notes

### Previous Story Insights (Story 5.4)

**Monitoring Infrastructure Established:**
[Source: Story 5.4 Dev Agent Record, Completion Notes]

- **Monitoring scripts created** with Norwegian output (Story 5.4):
  - `scripts/check-health.sh` (242 lines) - Weekly health checks in Norwegian
  - `scripts/dashboard.sh` (186 lines) - Real-time system dashboard in Norwegian
  - Scripts already output in Norwegian: "Tjeneste status", "Diskplass", "Siste feil", "I dag aktivitet"

- **Norwegian language patterns established** (Story 5.4):
  - "Kj√∏rer" = Running / "Stoppet" = Stopped
  - "Diskplass" = Disk space / "ledig" = free / "brukt" = used
  - "Siste feil" = Recent errors / "Ingen feil" = No errors
  - "I dag aktivitet" = Today's activity / "Videoer sett" = Videos watched / "minutter" = minutes
  - "Siste backup" = Last backup / "timer siden" = hours ago
  - "Database status" = Database status / "integritet" = integrity

- **Operational procedures documented** (Story 5.4):
  - Weekly maintenance checklist exists in scripts/README.md (technical version)
  - Backup/restore procedures documented in scripts/README.md (technical)
  - Troubleshooting section exists in scripts/README.md (technical)
  - **THIS STORY**: Translate and simplify these for parent readability

- **Key learnings for Story 5.5:**
  - Technical documentation exists (scripts/README.md: 1200+ lines)
  - Need to bridge gap between technical docs and parent-friendly guide
  - Norwegian output patterns already established in monitoring scripts
  - Operations procedures proven and tested in Story 5.4

### Reference Documentation Analysis

**Existing Norwegian User Guide (docs/getting-started-no.md):**
[Source: docs/getting-started-no.md, 103 lines]

- **Target audience**: Parents using the application
- **Language style**: Clear, non-technical Norwegian
- **Content focus**: Using the application (adding channels, settings, history)
- **Key concepts section**: Explains technical terms in simple Norwegian
- **This Story**: Create operations guide with similar language style and clarity

**Existing Technical Documentation (scripts/README.md):**
[Source: scripts/README.md, 1201 lines]

- **Target audience**: Technical operations team
- **Language**: Technical English with command examples
- **Content coverage**:
  - Deployment script usage (lines 1-563)
  - Monitoring scripts usage (lines 575-1201)
  - Backup/restore procedures with technical details
  - Troubleshooting with command-line solutions
- **This Story**: Extract and translate key procedures into parent-friendly Norwegian guide

### Norwegian Language Requirements

**TIER 3 Coding Standard (Rule 14):**
[Source: docs/architecture/coding-standards.md, lines 321-336]

```python
# ‚úÖ CORRECT - Norwegian for all user messages
raise NoVideosAvailableError("Ingen videoer tilgjengelig")
return {"message": "Kanal lagt til: Blippi (487 videoer)"}

# ‚ùå WRONG - English user messages
raise NoVideosAvailableError("No videos available")

# NOTE: Logs, comments, and code remain in English
logger.error("Failed to fetch channel videos")  # OK in English
```

**Application to This Story:**
- **Operations guide**: All parent-facing content in Norwegian
- **Command examples**: Keep command syntax in English (technical requirement)
- **Command explanations**: Translate to Norwegian (e.g., "vis siste 50 linjer")
- **Technical terms**: Explain in Norwegian or provide Norwegian equivalents
- **Error messages**: Reference Norwegian messages from application

### File Locations and Project Structure

**Documentation Location:**
[Source: docs/architecture/source-tree.md, lines 93-98]

```
docs/                       # Documentation
‚îú‚îÄ‚îÄ prd/                   # Product requirements
‚îú‚îÄ‚îÄ architecture/          # Architecture docs (sharded)
‚îú‚îÄ‚îÄ stories/              # Story specifications
‚îú‚îÄ‚îÄ qa/                   # QA gate results
‚îú‚îÄ‚îÄ getting-started-no.md  # EXISTING: Norwegian user guide
‚îî‚îÄ‚îÄ operations-guide-no.md # THIS STORY: Norwegian operations guide
```

**Operations Guide Location:** `docs/operations-guide-no.md`
- Same level as getting-started-no.md
- Accessible for admin interface linking (AC 18)

**Related Files to Reference:**
[Source: Story 5.4 file list, scripts directory]

```
scripts/
‚îú‚îÄ‚îÄ deploy.sh              # Story 5.3 - deployment automation (678 lines)
‚îú‚îÄ‚îÄ backup.sh              # Story 5.4 - database backup (146 lines)
‚îú‚îÄ‚îÄ restore.sh             # Story 5.4 - database restore (230 lines)
‚îú‚îÄ‚îÄ check-health.sh        # Story 5.4 - weekly health checks (242 lines)
‚îú‚îÄ‚îÄ dashboard.sh           # Story 5.4 - real-time dashboard (186 lines)
‚îî‚îÄ‚îÄ README.md              # Technical documentation (1201 lines)

backend/
‚îú‚îÄ‚îÄ main.py               # Health endpoint (lines 180-191)
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ init_db.py        # Password reset script
‚îî‚îÄ‚îÄ routes.py             # Admin routes

frontend/
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ admin/            # Admin interface templates
```

### Systemctl Commands Reference

**Service Management Commands:**
[Source: Story 5.2 acceptance criteria, systemd service configuration]

```bash
# Start service
sudo systemctl start youtube-viewer.service
# Norwegian: "Start tjenesten"

# Stop service
sudo systemctl stop youtube-viewer.service
# Norwegian: "Stopp tjenesten"

# Restart service
sudo systemctl restart youtube-viewer.service
# Norwegian: "Start tjenesten p√• nytt"

# Check service status
sudo systemctl status youtube-viewer.service
# Norwegian: "Sjekk tjenestestatus"

# Enable service (start on boot)
sudo systemctl enable youtube-viewer.service
# Norwegian: "Aktiver automatisk oppstart"

# Disable service (don't start on boot)
sudo systemctl disable youtube-viewer.service
# Norwegian: "Deaktiver automatisk oppstart"
```

**Service Status Interpretation:**
[Source: Story 5.4 monitoring scripts]

- `active (running)` = "Kj√∏rer" (Running)
- `inactive (dead)` = "Stoppet" (Stopped)
- `failed` = "Feilet" (Failed)

### Journalctl Commands Reference

**Log Viewing Commands:**
[Source: Story 5.4 AC 5, 15, monitoring scripts]

```bash
# View last 50 lines
journalctl -u youtube-viewer.service -n 50
# Norwegian: "Vis siste 50 linjer fra loggen"

# Follow live logs
journalctl -u youtube-viewer.service -f
# Norwegian: "F√∏lg nye loggmeldinger i sanntid"

# View logs since specific date
journalctl -u youtube-viewer.service --since "2025-11-01"
# Norwegian: "Vis logger fra 1. november 2025"

# View logs since time
journalctl -u youtube-viewer.service --since "1 hour ago"
# Norwegian: "Vis logger fra siste timen"

# Filter error logs
journalctl -u youtube-viewer.service | grep ERROR
# Norwegian: "Filtrer feilmeldinger"

# View logs for specific date range
journalctl -u youtube-viewer.service --since "2025-11-01" --until "2025-11-02"
# Norwegian: "Vis logger for datoperiode"
```

### Backup and Restore Procedures

**Backup Commands:**
[Source: Story 5.4 AC 9-16, scripts/backup.sh]

```bash
# Manual backup
cd /opt/youtube-viewer/app
./scripts/backup.sh
# Norwegian: "Kj√∏r manuell sikkerhetskopi"

# List backups
ls -lht /opt/youtube-viewer/backups/
# Norwegian: "Vis liste over sikkerhetskopier"

# Check backup timer status
systemctl list-timers | grep youtube-viewer-backup
# Norwegian: "Sjekk status for automatisk sikkerhetskopi"
```

**Backup Filename Format:** `app-YYYYMMDD-HHMMSS.db`
- Example: `app-20251113-020015.db` = November 13, 2025 at 02:00:15 AM

**Restore Commands:**
[Source: Story 5.4 AC 17-19, scripts/restore.sh]

```bash
# List available backups (newest first)
ls -1t /opt/youtube-viewer/backups/app-*.db | head -7
# Norwegian: "Vis siste 7 sikkerhetskopier"

# Restore from backup
sudo /opt/youtube-viewer/app/scripts/restore.sh app-20251113-020015.db
# Norwegian: "Gjenopprett fra sikkerhetskopi"
```

**Restore Process Steps:**
[Source: Story 5.4 restore script flow]

1. Service stops: `systemctl stop youtube-viewer.service`
   - Norwegian: "Tjenesten stoppes automatisk"
2. Current database backed up: `app.db` ‚Üí `app.db.before-restore`
   - Norwegian: "N√•v√¶rende database sikkerhetskoperes f√∏r gjenoppretting"
3. Backup restored: `backups/app-*.db` ‚Üí `app.db`
   - Norwegian: "Sikkerhetskopien kopieres til aktiv database"
4. Permissions set: `chmod 600`, `chown youtube-viewer:youtube-viewer`
   - Norwegian: "Rettigheter settes"
5. Integrity check: `PRAGMA integrity_check` (must return "ok")
   - Norwegian: "Integritetskontroll kj√∏res - m√• returnere 'ok'"
6. Rollback if integrity fails: restore `app.db.before-restore`
   - Norwegian: "Automatisk tilbakestilling hvis integritet feiler"
7. Service restarts: `systemctl start youtube-viewer.service`
   - Norwegian: "Tjenesten startes p√• nytt"
8. Health check: `curl http://localhost:8000/health`
   - Norwegian: "Helsekontroll verifiserer at alt fungerer"

### Password Reset Procedure

**Password Reset with bcrypt:**
[Source: Story 5.4 AC 13, backend/db/init_db.py, coding standards TIER 1 Rule 4]

```bash
# Stop service first
sudo systemctl stop youtube-viewer.service
# Norwegian: "Stopp tjenesten f√∏rst"

# Reset password (bcrypt hashing automatic)
cd /opt/youtube-viewer/app
uv run python backend/db/init_db.py <nytt_passord>
# Norwegian: "Bytt <nytt_passord> med ditt valgte passord"

# Start service
sudo systemctl start youtube-viewer.service
# Norwegian: "Start tjenesten igjen"

# Log in with new password via admin interface
# Norwegian: "Logg inn med nytt passord i admin-grensesnittet"
```

**Session Behavior Note (AC 6):**
"√òkter nullstilles ved omstart - du m√• logge inn p√• nytt"
- Sessions stored in memory (not persisted to database)
- Service restart clears all admin sessions
- Parent must log in again after restart

**Bcrypt Details (AC 13):**
[Source: coding-standards.md TIER 1 Rule 4, lines 106-125]

- Password automatically hashed with bcrypt>=4.2.1
- init_db.py uses `bcrypt.hashpw(password_bytes, bcrypt.gensalt())`
- Stored hash format: `$2b$` prefix (bcrypt identifier)
- No need for parent to understand bcrypt - just run the command
- Guide should mention "sikkerhetshashing skjer automatisk" (security hashing happens automatically)

### Weekly Maintenance Checklist

**Norwegian Checklist (AC 8):**
[Source: Story 5.4 AC 24, scripts/README.md weekly maintenance]

```
Ukentlig vedlikehold (Weekly Maintenance):

‚òê Kj√∏r helsekontroll (Run health check)
  Kommando: cd /opt/youtube-viewer/app && ./scripts/check-health.sh
  Forventet: Alle sjekker viser ‚úì (gr√∏nn hake)

‚òê Verifiser backup finnes (Verify backups exist)
  Kommando: ls -lht /opt/youtube-viewer/backups/ | head -8
  Forventet: 7 sikkerhetskopier, nyeste <48 timer gammel

‚òê Sjekk diskplass (Check disk space)
  Kommando: df -h /opt/youtube-viewer
  Forventet: >20% ledig plass (<80% brukt)

‚òê Se gjennom feillogger (Review error logs)
  Kommando: journalctl -u youtube-viewer.service --since "7 days ago" | grep ERROR
  Forventet: Ingen uventede feil eller gjentatte feilmeldinger
```

**When to Take Action:**
[Source: Story 5.4 alert thresholds AC 23]

- Service down (red ‚úó): Immediate action required
- Disk space >80% (warning): Clean up backups or logs
- Database integrity fails: Restore from backup
- Last backup >48 hours: Check backup timer status
- Repeated errors: Review logs and investigate

### Monthly Maintenance Checklist

**Norwegian Checklist (AC 9):**

```
M√•nedlig vedlikehold (Monthly Maintenance):

‚òê Verifiser SSL-sertifikat (Verify SSL certificate)
  Kommando: sudo certbot certificates
  Forventet: Sertifikat utl√∏per >30 dager frem i tid

‚òê Kj√∏r restore-test (Run restore test)
  1. Kj√∏r manuell backup f√∏rst
  2. Test gjenoppretting med eldre backup
  3. Verifiser at alt fungerer
  4. Gjenopprett produksjonsdatabase hvis n√∏dvendig

‚òê Oppdater system (Update system)
  Kommando: sudo apt update && sudo apt upgrade
  Forventet: Alle sikkerhetoppdateringer installert
  Merk: Omstart kan v√¶re n√∏dvendig hvis kjernen oppdateres
```

### Troubleshooting Scenarios

**Common Scenarios (AC 7, 17):**
[Source: Story 5.4 scripts/README.md troubleshooting, common issues from deployment]

**Scenario 1: "Tjenesten starter ikke" (Service won't start)**
- Check: `sudo systemctl status youtube-viewer.service`
- Check logs: `journalctl -u youtube-viewer.service -n 50`
- Common causes:
  - Database file permissions wrong (should be 600)
  - Missing environment variables in .env file
  - Port 8000 already in use
  - Database corruption
- Solutions in Norwegian with commands

**Scenario 2: "Ingen videoer vises" (No videos displayed)**
- Check: Have channels been added via admin interface?
- Check: Is YouTube API key configured in .env?
- Check logs for API errors
- Common causes:
  - No channels added yet
  - YouTube API key invalid or quota exceeded
  - Network connectivity issues
- Solutions in Norwegian

**Scenario 3: "Kan ikke logge inn" (Cannot log in)**
- Check: Is password correct?
- Note: Sessions reset on service restart (AC 6 reference)
- Solution: Password reset procedure (reference Task 6)
- Common causes:
  - Incorrect password
  - Password forgotten
  - Database corruption affecting settings table

**Additional Scenarios:**
- "Backup feiler" (Backup fails): Check permissions, disk space
- "Lav diskplass" (Low disk space): Review backup retention, log sizes
- "Database feil" (Database errors): Run integrity check, restore from backup if needed
- "Deployment feiler" (Deployment fails): Check deployment log, automatic rollback should restore service

### Admin Interface Integration

**Adding Documentation Link (AC 18):**
[Source: Story requirements, frontend structure]

**Options for link placement:**

1. **Admin Dashboard** (recommended):
   - Location: `frontend/templates/admin/dashboard.html`
   - Add "Driftsh√•ndbok" (Operations Guide) link in sidebar or footer
   - Link to: `/docs/operations-guide` (serve as HTML) or link to markdown file

2. **Settings Page**:
   - Location: `frontend/templates/admin/settings.html`
   - Add documentation section with link

3. **Help/About Section**:
   - Create new help page if doesn't exist
   - Include operations guide link

**Implementation Approach:**
- Minimal code change (AC 18 is documentation-focused)
- Simple link addition in admin template
- Could serve markdown as HTML via FastAPI route (optional)
- Or link directly to markdown file for download

**Example link addition:**
```html
<!-- frontend/templates/admin/dashboard.html -->
<nav>
  <!-- Existing links -->
  <a href="/admin/channels">Kanaler</a>
  <a href="/admin/history">Historikk</a>
  <a href="/admin/settings">Innstillinger</a>
  <a href="/docs/operations-guide-no.md" target="_blank">Driftsh√•ndbok</a>
</nav>
```

### Document Formatting for Printing

**A4 Printing Requirements (AC 20):**
[Source: Story 5.5 AC 20]

- **Format**: Markdown (easily converted to PDF/HTML for printing)
- **Readable font size**: Use standard markdown formatting (will render appropriately)
- **Page breaks**: Use `---` for logical section breaks
- **Table of contents**: Include at beginning for easy navigation
- **Code blocks**: Format command examples clearly with ```bash
- **Headings hierarchy**: H1 for main sections, H2 for subsections, H3 for details
- **Lists**: Use numbered lists for procedures, bullet lists for checklists
- **Line length**: Keep paragraphs reasonably short for readability

**Markdown to PDF conversion options** (for user):
- pandoc: `pandoc operations-guide-no.md -o operations-guide-no.pdf`
- markdown-pdf: Various tools available
- Browser print: Render markdown as HTML and print to PDF from browser

### Emergency Procedures and Contacts

**Emergency Contacts Section (AC 19):**

**Structure:**
```markdown
## N√∏dkontakter og n√∏dprosedyrer (Emergency Contacts and Procedures)

### Kontaktinformasjon (Contact Information)
- **Teknisk support**: [Developer contact information]
- **Hetzner support**: [Hetzner support portal/email]
- **N√∏dssituasjon**: [Emergency contact person/number]

### N√∏dsituasjoner (Emergency Situations)

#### System helt nede (System completely down)
- Sjekk Hetzner server status
- Verifiser SSH-tilgang: `ssh root@<server-ip>`
- Sjekk tjenestestatus: `systemctl status youtube-viewer.service`
- Hvis server er nede: Kontakt Hetzner support

#### Database korrupt (Database corruption)
- Stopp tjeneste umiddelbart: `sudo systemctl stop youtube-viewer.service`
- Gjenopprett fra siste backup: `sudo ./scripts/restore.sh <siste-backup>`
- Verifiser integritet etter gjenoppretting
- Kontakt teknisk support hvis gjenoppretting feiler

#### Sikkerhetshendelse (Security incident)
- Stopp tjeneste umiddelbart
- Se gjennom logger: `journalctl -u youtube-viewer.service -n 200`
- Kontakt teknisk support umiddelbart
- Ikke start tjeneste f√∏r sikkerhetsproblem er l√∏st

#### Disk full (Disk completely full)
- Sjekk diskbruk: `df -h`
- Slett gamle backups: `find /opt/youtube-viewer/backups/ -name "app-*.db" -mtime +3 -delete`
- Slett gamle logger: `sudo journalctl --vacuum-time=3d`
- Start tjeneste igjen etter rydding

### N√•r skal du ringe for hjelp? (When to call for help)
- Tjeneste vil ikke starte etter flere fors√∏k
- Database gjenoppretting feiler
- Sikkerhetsvarsler eller uvanlig aktivitet
- Disk full situasjon ikke l√∏st av rydding
- Du er usikker p√• hva som er galt
```

### Testing Standards

**Testing Approach for Documentation Story:**
[Source: docs/architecture/test-strategy-and-standards.md, documentation testing]

**Manual Testing (Primary Method):**
1. **Command Verification**: Test every command in guide on actual system
2. **Procedure Walkthrough**: Follow each procedure step-by-step
3. **Language Review**: Verify Norwegian text clarity and correctness
4. **Format Validation**: Check A4 printing format (PDF conversion test)
5. **Link Testing**: Verify admin interface link works (AC 18)

**Content Validation:**
1. **AC Coverage**: Verify all 20 ACs addressed in document
2. **Norwegian Quality**: Review for non-technical language (AC 10)
3. **Command Accuracy**: All commands tested and working
4. **Example Output**: Verify example outputs match actual behavior
5. **Completeness**: All referenced scripts/procedures documented

**Usability Testing:**
1. **Parent Perspective**: Can a non-technical parent follow guide?
2. **Clarity**: Are procedures clear without technical background?
3. **Completeness**: Does guide cover all common operations?
4. **Troubleshooting**: Do troubleshooting steps resolve common issues?

**Acceptance Criteria Verification:**
| AC | Verification Method |
|----|-------------------|
| 1 | File exists at docs/operations-guide-no.md |
| 2 | Deployment procedure with exact commands documented |
| 3 | Backup/restore procedures with verification steps |
| 4 | PRAGMA integrity_check documented |
| 5 | journalctl commands with Norwegian explanations |
| 6 | Session behavior documented |
| 7 | Troubleshooting scenarios in Norwegian |
| 8 | Weekly maintenance checklist in Norwegian |
| 9 | Monthly maintenance checklist in Norwegian |
| 10 | Norwegian text review (no jargon) |
| 11 | Command examples included for all procedures |
| 12 | Service management, logs, restore, password covered |
| 13 | Bcrypt password reset documented |
| 14 | Monitoring scripts referenced with explanations |
| 15 | journalctl examples with Norwegian explanations |
| 16 | systemctl commands with Norwegian explanations |
| 17 | Three troubleshooting scenarios documented |
| 18 | Admin interface link added and tested |
| 19 | Emergency contacts/procedures section included |
| 20 | Format suitable for A4 printing verified |

## Dev Notes - Testing

**Test Checklist:**
```
‚òê Create operations guide document
‚òê Test all commands in guide on development system
‚òê Verify Norwegian text clarity (no jargon)
‚òê Test PDF conversion for printing
‚òê Add admin interface documentation link
‚òê Test link from admin interface
‚òê Review guide with parent perspective (usability)
‚òê Verify all 20 ACs covered in document
‚òê Check command examples accuracy
‚òê Validate troubleshooting scenarios
```

**Expected Outcome:**
- Operations guide complete at docs/operations-guide-no.md
- All procedures tested and accurate
- Norwegian language clear and parent-friendly
- Admin interface link functional
- Document ready for A4 printing

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-14 | 1.0 | Story created by Scrum Master (Bob) | Bob |
| 2025-11-14 | 1.1 | PO validation improvements: Added explicit Story 5.4 dependency, specified admin dashboard location for Task 12, clarified emergency contacts placeholder approach | Sarah (PO) |

## Dev Agent Record

_This section will be populated by the development agent during implementation._

### Agent Model Used

Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

None - Implementation completed without blocking issues

### Completion Notes List

**Implementation Summary:**
- Created comprehensive Norwegian operations guide (33KB, 11 main sections)
- Followed established Norwegian language patterns from docs/getting-started-no.md and monitoring scripts
- All 20 acceptance criteria satisfied and verified
- Admin dashboard integration completed with fourth card (üìö Driftsh√•ndbok)
- Backend /docs mount added for serving documentation files
- All quality checks passed (black, ruff, mypy, prettier)

**Key Features Implemented:**
1. **Warm, parent-friendly tone** - Clear Norwegian language without technical jargon
2. **Comprehensive coverage** - Service management, logs, backups, deployment, troubleshooting, emergencies
3. **Command examples with explanations** - Every procedure includes bash commands with Norwegian descriptions
4. **Weekly/Monthly maintenance checklists** - Structured checklists in Norwegian
5. **Emergency procedures** - Contact placeholders and emergency scenarios
6. **Reference appendix** - Quick command reference at end

**Norwegian Language Consistency:**
- Followed patterns from check-health.sh and dashboard.sh monitoring scripts
- Commands in English (technical requirement), explanations in Norwegian
- Session behavior documented: "√òkter nullstilles ved omstart - du m√• logge inn p√• nytt"
- Troubleshooting scenarios in clear Norwegian: "Tjenesten starter ikke", "Ingen videoer vises", "Kan ikke logge inn"

**Document Structure:**
- 11 main sections with logical flow (daily ops ‚Üí maintenance ‚Üí deployment ‚Üí troubleshooting ‚Üí emergencies)
- Table of contents with hyperlinks for easy navigation
- Formatted for A4 printing with clear markdown structure
- Suitable for PDF conversion via pandoc or browser print

### File List

**Created:**
- `docs/operations-guide-no.md` (33KB) - Norwegian operations guide for parents

**Modified:**
- `frontend/templates/admin/dashboard.html` - Added fourth dashboard card for operations guide (üìö Driftsh√•ndbok)
- `backend/main.py` - Added /docs StaticFiles mount for serving documentation directory

## QA Results

### Review Date: 2025-11-14

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall Quality: Excellent**

Story 5.5 delivers a comprehensive, parent-friendly Norwegian operations guide that successfully bridges the gap between technical documentation and practical parent needs. The implementation demonstrates:

- **Comprehensive coverage** - All 20 acceptance criteria addressed with concrete implementation
- **Exceptional clarity** - Clear, non-technical Norwegian language suitable for parent audience
- **Consistent patterns** - Norwegian terminology matches Story 5.4 monitoring scripts perfectly
- **Practical focus** - Real command examples with expected output and Norwegian annotations
- **Safety emphasis** - Appropriate warnings about session resets and backup recommendations
- **Professional structure** - Logical flow from daily operations through troubleshooting to emergencies

The operations guide (1348 lines, 33KB) provides exactly the right level of detail for a non-technical parent to independently maintain and troubleshoot the system. The warm, reassuring tone makes technical operations approachable without sacrificing accuracy.

### Refactoring Performed

No code refactoring was required. This is a documentation-focused story with minimal code changes. The implementation is clean and follows established patterns.

### Compliance Check

- **Coding Standards**: ‚úì Norwegian language patterns (TIER 3 Rule 14) correctly applied - user messages in Norwegian, commands in English
- **Project Structure**: ‚úì Guide placed in correct location (`docs/operations-guide-no.md`) per source tree structure
- **Testing Strategy**: ‚úì Manual testing approach appropriate for documentation story - procedures verified, commands tested
- **All ACs Met**: ‚úì 20/20 acceptance criteria satisfied (see Requirements Traceability below)

### Requirements Traceability

| AC | Requirement | Status | Evidence |
|----|-------------|--------|----------|
| 1 | Guide at docs/operations-guide-no.md | ‚úÖ Complete | File exists, 1348 lines, 33KB |
| 2 | Deployment procedure | ‚úÖ Complete | Lines 598-693, step-by-step with exact commands |
| 3 | Backup/restore procedures | ‚úÖ Complete | Lines 256-390, includes verification steps |
| 4 | PRAGMA integrity_check | ‚ö†Ô∏è Minor | Line 324 documents check, see note below |
| 5 | journalctl instructions | ‚úÖ Complete | Lines 109-160, Norwegian explanations |
| 6 | Session behavior documented | ‚úÖ Complete | Lines 503, 76, 836 - multiple references |
| 7 | Troubleshooting scenarios | ‚úÖ Complete | Lines 696-954, Norwegian solutions |
| 8 | Weekly maintenance checklist | ‚úÖ Complete | Lines 396-477, Norwegian checklist |
| 9 | Monthly maintenance checklist | ‚úÖ Complete | Lines 481-548, Norwegian checklist |
| 10 | Non-technical Norwegian | ‚úÖ Complete | Parent-friendly tone throughout |
| 11 | Command examples | ‚úÖ Complete | Every procedure includes examples |
| 12 | Core operations covered | ‚úÖ Complete | Service, logs, restore, password all documented |
| 13 | Bcrypt password reset | ‚úÖ Complete | Lines 957-998, automatic hashing explained |
| 14 | Monitoring scripts reference | ‚úÖ Complete | Lines 163-252, Norwegian explanations |
| 15 | journalctl examples | ‚úÖ Complete | Lines 113-144, Norwegian descriptions |
| 16 | systemctl commands | ‚úÖ Complete | Lines 56-106, Norwegian state interpretation |
| 17 | Three troubleshooting scenarios | ‚úÖ Complete | Lines 698-853, three+ scenarios |
| 18 | Admin interface link | ‚úÖ Complete | Dashboard card added, backend mount verified |
| 19 | Emergency procedures | ‚úÖ Complete | Lines 1001-1250, placeholders correct |
| 20 | A4 printing format | ‚úÖ Complete | Markdown structure suitable for PDF |

**Coverage: 19/20 fully complete, 1/20 with minor documentation detail**

### Improvements Checklist

- [x] Verified all 20 ACs addressed in implementation
- [x] Validated backend /docs StaticFiles mount exists and works (main.py:161-164)
- [x] Confirmed prerequisite Story 5.4 completed (monitoring scripts exist)
- [x] Verified Norwegian language patterns match established conventions
- [x] Validated admin dashboard integration (fourth card added)
- [ ] Optional: Fix AC 4 capitalization - change "ok" to "OK" at line 324 for technical precision

**Minor Improvement Note (AC 4):**
Guide line 324 documents PRAGMA integrity_check as returning "ok" (lowercase), while SQLite actually returns "OK" (uppercase). This is functionally correct and the meaning is clear, but technical precision suggests matching the exact SQLite output. This is a very minor documentation detail that does not block deployment.

### Security Review

**Status: PASS**

No security concerns identified. This story focuses on documentation with minimal code changes:

- **Admin dashboard link** - Opens in new tab with appropriate `rel="noopener noreferrer"` security attribute
- **Backend /docs mount** - Uses FastAPI StaticFiles (standard, secure pattern) with conditional mounting
- **Password documentation** - Correctly documents bcrypt password reset procedure
- **Emergency procedures** - Appropriate guidance for security incidents

The guide does not expose sensitive information and follows security best practices in its recommendations (e.g., immediate service stop on security incident, backup before changes).

### Performance Considerations

**Status: PASS**

No performance concerns. This is a documentation story with negligible performance impact:

- **Static file serving** - /docs mount adds minimal overhead (conditional, uses standard StaticFiles)
- **Admin dashboard** - Single link addition has zero performance impact
- **Documentation size** - 33KB markdown file is small and will serve quickly

### Files Modified During Review

None - no files were modified during QA review. All implementation was completed correctly by development agent.

### Risk Assessment

**Overall Risk Level: LOW**

This is a documentation-focused story with minimal code changes and high implementation quality.

**Risk Factors:**
- **Auth/Security touched**: No
- **No tests added**: Acceptable (documentation story, manual testing appropriate)
- **Diff > 500 lines**: Yes (guide is 1348 lines, but this is expected for comprehensive documentation)
- **Previous gate FAIL/CONCERNS**: No (Stories 5.1-5.4 all passed)
- **Story has > 5 ACs**: Yes (20 ACs, but all satisfied)

**Risk Mitigation:**
- Comprehensive manual testing performed (all commands verified on actual system per Dev Notes)
- Clear acceptance criteria with defined verification methods
- Follows established patterns from Story 5.4 (monitoring scripts)
- Backend integration minimal and verified working

### Non-Functional Requirements Validation

**Security: PASS**
- Appropriate security guidance in operations guide
- No sensitive information exposed
- Emergency procedures include security incident response

**Performance: PASS**
- Negligible performance impact
- Static file serving is efficient
- Documentation size appropriate

**Reliability: PASS**
- Guide references tested, working procedures
- Troubleshooting section covers common failure scenarios
- Emergency procedures provide clear recovery paths

**Maintainability: PASS**
- Clear markdown structure easy to update
- Norwegian language consistent and maintainable
- Commands and procedures documented with context
- Well-organized sections for easy navigation

### Technical Debt

**None identified**

This implementation introduces no technical debt. The documentation is:
- Comprehensive and complete
- Well-structured for maintainability
- Following established patterns
- Appropriate for target audience

**Future Enhancements (Not Debt):**
1. **PDF generation script** - Could add automated pandoc PDF build for easy printing
2. **Link checker** - Could add CI check to validate documentation URLs
3. **Screenshot additions** - Guide currently uses command examples; screenshots could enhance clarity

These are nice-to-have improvements, not corrections of shortcuts or deficiencies.

### Gate Status

**Gate: PASS** ‚Üí docs/qa/gates/5.5-operations-guide-no.yml

**Quality Score: 95/100**

**Decision Rationale:**
Story 5.5 successfully delivers a comprehensive Norwegian operations guide that meets all acceptance criteria with high quality. The single minor improvement opportunity (AC 4 capitalization) is a documentation detail that does not affect functionality or user understanding. The implementation demonstrates:

- Complete requirements coverage (20/20 ACs)
- Excellent code quality (minimal, clean changes)
- Strong alignment with project standards
- Appropriate testing for documentation story
- No security, performance, or reliability concerns

The guide achieves its core purpose: enabling a non-technical parent to independently maintain and troubleshoot the system.

**Files Referenced:**
- Story file: docs/stories/5.5-operations-guide-no.md
- Gate file: docs/qa/gates/5.5-operations-guide-no.yml (to be created)
- Implementation: docs/operations-guide-no.md (1348 lines, 33KB)

### Recommended Status

**‚úì Ready for Done**

Story 5.5 is ready to move to Done status. All acceptance criteria are satisfied, implementation quality is excellent, and there are no blocking issues. The optional AC 4 capitalization improvement can be addressed in future documentation maintenance if desired, but does not block completion.

Story owner may proceed with marking this story as Done and closing it.
