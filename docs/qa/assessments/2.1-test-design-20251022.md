# Test Design: Story 2.1 - Child-Friendly Video Grid Interface

**Date:** 2025-10-22
**Designer:** Quinn (Test Architect)
**Story:** 2.1 - Child-Friendly Video Grid Interface
**Status:** Draft

## Test Strategy Overview

- **Total test scenarios:** 48
- **Unit tests:** 18 (37.5%)
- **Integration tests:** 16 (33.3%)
- **E2E tests:** 14 (29.2%)
- **Priority distribution:**
  - P0: 12 scenarios (25%) - Safety-critical, TIER 1 rules
  - P1: 24 scenarios (50%) - Core user journeys
  - P2: 12 scenarios (25%) - Secondary features

## Testing Philosophy

This story implements the child's primary interface for video discovery, making it a **critical user journey** with **safety implications**. The test strategy emphasizes:

1. **Safety First** - P0 coverage for all TIER 1 rules (banned videos, unavailable videos, time limits)
2. **Algorithm Validation** - Extensive testing of weighted random selection with multiple iterations
3. **Responsive Design** - Multi-viewport validation for target devices
4. **XSS Prevention** - Security testing for frontend rendering
5. **User Experience** - E2E validation of complete child viewing journey

## Test Scenarios by Acceptance Criteria

### AC1: Grid displays configurable number of thumbnails (default 9, range 4-15)

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-UNIT-001 | Unit        | P1       | Validate count parameter within range (4-15)           | Pure validation logic, fast feedback                             |
| 2.1-UNIT-002 | Unit        | P1       | Default to 9 when count not provided                   | Default behavior testing                                         |
| 2.1-UNIT-003 | Unit        | P1       | Reject count < 4 with error                            | Boundary condition testing                                       |
| 2.1-UNIT-004 | Unit        | P1       | Reject count > 15 with error                           | Boundary condition testing                                       |
| 2.1-INT-001  | Integration | P1       | GET /api/videos returns requested count                | API contract validation                                          |
| 2.1-INT-002  | Integration | P1       | Fetch grid_size setting from database                  | Database integration for configuration                           |
| 2.1-E2E-001  | E2E         | P1       | Grid renders with 9 videos on initial load             | Critical happy path for child user journey                       |
| 2.1-E2E-002  | E2E         | P2       | Grid respects parent-configured grid_size (e.g., 12)   | Configuration validation (secondary priority)                    |

**Coverage Summary:** 8 scenarios (4 unit, 2 integration, 2 e2e)

---

### AC2: Weighted random selection algorithm (60-80% novelty, 20-40% favorites)

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-UNIT-005 | Unit        | P0       | Calculate novelty vs favorites split (60-80% range)    | Core algorithm logic, high complexity                            |
| 2.1-UNIT-006 | Unit        | P1       | Separate videos into novelty and favorites pools       | Algorithm component testing                                      |
| 2.1-UNIT-007 | Unit        | P1       | Handle case where novelty pool is empty                | Edge case: all videos are favorites                              |
| 2.1-UNIT-008 | Unit        | P1       | Handle case where favorites pool is empty              | Edge case: all videos are novel                                  |
| 2.1-UNIT-009 | Unit        | P1       | Fill remaining slots when pools exhausted              | Algorithm fallback logic                                         |
| 2.1-INT-003  | Integration | P1       | Algorithm with real watch history data                 | Integration with database watch history                          |
| 2.1-INT-004  | Integration | P1       | Selection excludes videos watched today                | Verify novelty calculation with UTC dates                        |
| 2.1-INT-005  | Integration | P0       | **TIER 1:** Banned videos NEVER in results (50 runs)  | **SAFETY CRITICAL** - Rule 1: Always filter banned videos        |
| 2.1-INT-006  | Integration | P0       | **TIER 1:** Unavailable videos NEVER in results (50 runs) | **SAFETY CRITICAL** - Rule 1: Filter unavailable videos       |
| 2.1-INT-007  | Integration | P1       | Randomness validated over multiple selections (20 runs)| Verify true randomness, no deterministic patterns                |

**Coverage Summary:** 10 scenarios (5 unit, 5 integration)
**TIER 1 Tests:** 2 scenarios (marked P0)

---

### AC3: Thumbnails large and clickable (minimum 200x150px)

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-E2E-003  | E2E         | P1       | Thumbnail dimensions meet minimum 200x150px            | Visual validation for child usability                            |
| 2.1-E2E-004  | E2E         | P1       | Clicking thumbnail triggers video selection            | Core interaction for child user journey                          |
| 2.1-E2E-005  | E2E         | P1       | Cards disabled during loading state                    | UX validation, prevent double-clicks                             |

**Coverage Summary:** 3 scenarios (3 e2e)

---

### AC4: Video titles appear below thumbnails in readable font

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-UNIT-010 | Unit        | P0       | **TIER 1:** Title rendering uses textContent (not innerHTML) | **SECURITY CRITICAL** - XSS prevention                       |
| 2.1-E2E-006  | E2E         | P1       | Titles render below thumbnails                         | Layout validation                                                |
| 2.1-E2E-007  | E2E         | P1       | Font size minimum 16px for readability                 | Accessibility requirement for young children                     |
| 2.1-E2E-008  | E2E         | P2       | Long titles truncate with ellipsis                     | Edge case: text overflow handling                                |

**Coverage Summary:** 4 scenarios (1 unit, 3 e2e)
**TIER 1 Tests:** 1 scenario (XSS prevention)

---

### AC5: Colorful, playful CSS styling with yellow accents

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-E2E-009  | E2E         | P2       | Yellow accent color (--color-primary) used in borders | Design system validation                                         |
| 2.1-E2E-010  | E2E         | P2       | Hover/focus states show visual feedback                | Interaction feedback for child users                             |
| 2.1-E2E-011  | E2E         | P2       | Cards have rounded corners and shadows                 | Playful aesthetic validation                                     |

**Coverage Summary:** 3 scenarios (3 e2e)

---

### AC6: Page works on 1920x1080 screens (laptop primary)

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-E2E-012  | E2E         | P1       | Grid renders properly at 1920x1080 resolution          | Primary target device validation                                 |
| 2.1-E2E-013  | E2E         | P1       | 3-column layout on desktop viewport                    | Layout structure validation                                      |

**Coverage Summary:** 2 scenarios (2 e2e)

---

### AC7: Responsive layout adapts for tablet screens (1024x768 minimum)

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-E2E-014  | E2E         | P1       | Grid renders properly at 1024x768 resolution           | Tablet device validation                                         |
| 2.1-E2E-015  | E2E         | P1       | 2-column layout on tablet viewport                     | Responsive breakpoint validation                                 |
| 2.1-E2E-016  | E2E         | P2       | Media queries activate at correct breakpoints          | CSS breakpoint validation (768px, 1024px)                        |

**Coverage Summary:** 3 scenarios (3 e2e)

---

### AC8: No navigation elements or text-based menus

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-E2E-017  | E2E         | P2       | Verify no nav elements present in DOM                  | Child-friendly interface requirement                             |
| 2.1-E2E-018  | E2E         | P2       | Verify no text-based menus present                     | Simplicity requirement for ages 2-6                              |

**Coverage Summary:** 2 scenarios (2 e2e)

---

### AC9: Mascot character visible in corner or header

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-E2E-019  | E2E         | P2       | Mascot image renders and is visible                    | Child-friendly design element                                    |
| 2.1-E2E-020  | E2E         | P2       | Mascot positioned in corner (top-right)                | Visual layout validation                                         |

**Coverage Summary:** 2 scenarios (2 e2e)

---

### AC10: Grid refreshes when returning from video playback

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-UNIT-011 | Unit        | P1       | get_videos_for_grid() returns new selection each call  | Algorithm generates new results                                  |
| 2.1-INT-008  | Integration | P1       | API returns different videos on subsequent calls       | State independence validation                                    |
| 2.1-E2E-021  | E2E         | P1       | Grid displays different videos after video playback    | Complete user journey validation                                 |

**Coverage Summary:** 3 scenarios (1 unit, 1 integration, 1 e2e)

---

### AC11: Grid size controlled by grid_size setting in admin interface

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-UNIT-012 | Unit        | P1       | get_setting('grid_size') returns configured value      | Database query logic                                             |
| 2.1-UNIT-013 | Unit        | P1       | Default to 9 when grid_size not set                    | Default value handling                                           |
| 2.1-INT-009  | Integration | P1       | Setting change reflected in grid size                  | Configuration system integration                                 |

**Coverage Summary:** 3 scenarios (2 unit, 1 integration)

---

## Additional Cross-Cutting Test Scenarios

### Time Limit Integration (References AC2 - daily limit calculation)

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-UNIT-014 | Unit        | P0       | **TIER 1:** Calculate minutes_watched excludes manual_play | **SAFETY CRITICAL** - Rule 2: Time limit accuracy            |
| 2.1-UNIT-015 | Unit        | P0       | **TIER 1:** Calculate minutes_watched excludes grace_play | **SAFETY CRITICAL** - Rule 2: Time limit accuracy             |
| 2.1-UNIT-016 | Unit        | P1       | get_daily_limit() state: normal (>10 min remaining)    | State machine validation                                         |
| 2.1-UNIT-017 | Unit        | P1       | get_daily_limit() state: winddown (≤10 min)            | State machine validation                                         |
| 2.1-UNIT-018 | Unit        | P1       | get_daily_limit() state: grace (0 min)                 | State machine validation                                         |
| 2.1-INT-010  | Integration | P0       | **TIER 1:** Wind-down filters videos by max_duration   | **SAFETY CRITICAL** - Enforce time limits                        |
| 2.1-INT-011  | Integration | P1       | Wind-down shows all videos if none fit duration        | Fallback behavior (better than empty grid)                       |

**Coverage Summary:** 7 scenarios (5 unit, 2 integration)
**TIER 1 Tests:** 3 scenarios (time limit rules)

---

### Data Integrity & Error Handling

| ID           | Level       | Priority | Test Scenario                                          | Justification                                                    |
| ------------ | ----------- | -------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| 2.1-INT-012  | Integration | P0       | **TIER 1:** SQL uses placeholders (no string formatting) | **SECURITY CRITICAL** - SQL injection prevention             |
| 2.1-INT-013  | Integration | P1       | Handle NoVideosAvailableError with Norwegian message   | Error handling with user-facing message                          |
| 2.1-INT-014  | Integration | P1       | Return 503 status when no videos available             | API contract for error state                                     |
| 2.1-INT-015  | Integration | P0       | **TIER 1:** Always use UTC for datetime operations    | **SAFETY CRITICAL** - Rule 3: Time zone consistency              |
| 2.1-INT-016  | Integration | P1       | Database context manager used for all queries          | Resource management validation                                   |

**Coverage Summary:** 5 scenarios (5 integration)
**TIER 1 Tests:** 2 scenarios (SQL security, UTC time)

---

## Test Scenarios Summary Table

### By Level

| Level       | P0 (Critical) | P1 (High) | P2 (Medium) | **Total** |
| ----------- | ------------- | --------- | ----------- | --------- |
| Unit        | 5             | 11        | 2           | **18**    |
| Integration | 5             | 9         | 2           | **16**    |
| E2E         | 2             | 9         | 3           | **14**    |
| **Total**   | **12**        | **29**    | **7**       | **48**    |

### By Acceptance Criteria

| AC  | Description                      | Unit | Integration | E2E | Total |
| --- | -------------------------------- | ---- | ----------- | --- | ----- |
| 1   | Configurable grid                | 4    | 2           | 2   | 8     |
| 2   | Weighted random selection        | 5    | 5           | 0   | 10    |
| 3   | Large clickable thumbnails       | 0    | 0           | 3   | 3     |
| 4   | Video titles                     | 1    | 0           | 3   | 4     |
| 5   | Playful CSS styling              | 0    | 0           | 3   | 3     |
| 6   | Desktop layout (1920x1080)       | 0    | 0           | 2   | 2     |
| 7   | Tablet responsive (1024x768)     | 0    | 0           | 3   | 3     |
| 8   | No navigation elements           | 0    | 0           | 2   | 2     |
| 9   | Mascot visibility                | 0    | 0           | 2   | 2     |
| 10  | Grid refresh after playback      | 1    | 1           | 1   | 3     |
| 11  | Grid size from settings          | 2    | 1           | 0   | 3     |
| -   | Time limits (cross-cutting)      | 5    | 2           | 0   | 7     |
| -   | Error handling (cross-cutting)   | 0    | 5           | 0   | 5     |

---

## TIER 1 Safety Test Coverage

**Critical:** All TIER 1 safety rules MUST have dedicated P0 test coverage.

| TIER 1 Rule | Test IDs                                          | Coverage | Status |
| ----------- | ------------------------------------------------- | -------- | ------ |
| **Rule 1:** Filter banned/unavailable videos | 2.1-INT-005, 2.1-INT-006                | 2 scenarios | ✅ Covered |
| **Rule 2:** Exclude manual_play/grace_play from limits | 2.1-UNIT-014, 2.1-UNIT-015      | 2 scenarios | ✅ Covered |
| **Rule 3:** UTC time for all operations | 2.1-INT-015                                     | 1 scenario  | ✅ Covered |
| **Rule 5:** XSS prevention (textContent) | 2.1-UNIT-010                                   | 1 scenario  | ✅ Covered |
| **Rule 6:** SQL placeholders only | 2.1-INT-012                                           | 1 scenario  | ✅ Covered |

**TIER 1 Total:** 12 P0 scenarios (5 unit, 5 integration, 2 e2e)

---

## Risk Coverage Matrix

| Risk ID       | Risk Description                              | Probability | Impact | Test Coverage                                |
| ------------- | --------------------------------------------- | ----------- | ------ | -------------------------------------------- |
| RISK-SAFETY-01| Banned videos appear in child grid            | Medium      | Critical | 2.1-INT-005 (50 iteration test)             |
| RISK-SAFETY-02| Unavailable videos appear in grid             | Medium      | High     | 2.1-INT-006 (50 iteration test)             |
| RISK-SAFETY-03| Time limits calculated incorrectly            | Low         | Critical | 2.1-UNIT-014, 2.1-UNIT-015, 2.1-INT-010     |
| RISK-SAFETY-04| SQL injection via count parameter             | Low         | Critical | 2.1-INT-012                                 |
| RISK-SAFETY-05| XSS via malicious video titles                | Low         | High     | 2.1-UNIT-010                                |
| RISK-UX-01    | Grid empty when videos available              | Medium      | High     | 2.1-INT-011, 2.1-INT-013                    |
| RISK-UX-02    | Algorithm too deterministic (not random)      | Medium      | Medium   | 2.1-INT-007 (20 iteration test)             |
| RISK-UX-03    | Responsive layout breaks on target devices    | Low         | High     | 2.1-E2E-012, 2.1-E2E-014                    |
| RISK-PERF-01  | API response slow with large video catalog    | Low         | Medium   | Benchmark tests (Story 1.X infrastructure)  |

---

## Recommended Test Execution Order

### Phase 1: Safety-Critical (P0) - Run First
**Fail fast if safety rules violated**

1. **TIER 1 Unit Tests** (5 tests, ~2 minutes)
   - 2.1-UNIT-010: XSS prevention
   - 2.1-UNIT-014: Exclude manual_play from limits
   - 2.1-UNIT-015: Exclude grace_play from limits

2. **TIER 1 Integration Tests** (5 tests, ~5 minutes)
   - 2.1-INT-005: Banned videos NEVER appear (50 runs)
   - 2.1-INT-006: Unavailable videos NEVER appear (50 runs)
   - 2.1-INT-010: Wind-down filters by duration
   - 2.1-INT-012: SQL placeholders used
   - 2.1-INT-015: UTC time operations

3. **TIER 1 E2E Tests** (2 tests, ~3 minutes)
   - 2.1-E2E-004: Click interaction works
   - 2.1-E2E-021: Grid refresh journey

**Phase 1 Total:** 12 tests, ~10 minutes

---

### Phase 2: Core Functionality (P1) - Run Second
**Validate main user journeys and algorithm**

1. **Algorithm Unit Tests** (11 tests, ~3 minutes)
   - 2.1-UNIT-001 to 2.1-UNIT-009: Grid config, weighted selection
   - 2.1-UNIT-011: Grid regeneration
   - 2.1-UNIT-016 to 2.1-UNIT-018: Time limit states

2. **API & Database Integration** (9 tests, ~7 minutes)
   - 2.1-INT-001 to 2.1-INT-004: API contracts, database queries
   - 2.1-INT-007: Randomness validation (20 runs)
   - 2.1-INT-008 to 2.1-INT-009: State management
   - 2.1-INT-011, 2.1-INT-013, 2.1-INT-014, 2.1-INT-016: Error handling

3. **User Journey E2E** (9 tests, ~12 minutes)
   - 2.1-E2E-001 to 2.1-E2E-003: Initial grid render
   - 2.1-E2E-005 to 2.1-E2E-007: UI interactions
   - 2.1-E2E-012 to 2.1-E2E-015: Responsive layouts

**Phase 2 Total:** 29 tests, ~22 minutes

---

### Phase 3: Secondary Features (P2) - Run If Time Permits
**Visual polish and aesthetics**

1. **E2E Visual Validation** (3 tests, ~5 minutes)
   - 2.1-E2E-008: Long title truncation
   - 2.1-E2E-009 to 2.1-E2E-011: CSS styling
   - 2.1-E2E-016: Media query breakpoints
   - 2.1-E2E-017 to 2.1-E2E-020: Layout elements

**Phase 3 Total:** 7 tests, ~5 minutes

---

### Total Execution Time Estimate

- **Phase 1 (P0):** ~10 minutes
- **Phase 2 (P1):** ~22 minutes
- **Phase 3 (P2):** ~5 minutes
- **Grand Total:** ~37 minutes for full regression

---

## Test Implementation Mapping

### Backend Tests

**File:** `tests/backend/safety/test_tier1_safety_rules.py`
- 2.1-INT-005: `test_banned_videos_never_in_grid_50_runs()`
- 2.1-INT-006: `test_unavailable_videos_never_in_grid_50_runs()`
- 2.1-UNIT-014: `test_time_limit_excludes_manual_play()`
- 2.1-UNIT-015: `test_time_limit_excludes_grace_play()`

**File:** `tests/backend/services/test_viewing_session.py`
- 2.1-UNIT-005 to 2.1-UNIT-009: Weighted selection algorithm
- 2.1-UNIT-011: Grid regeneration
- 2.1-UNIT-012 to 2.1-UNIT-013: Settings retrieval
- 2.1-UNIT-016 to 2.1-UNIT-018: Daily limit states
- 2.1-INT-003 to 2.1-INT-004: Algorithm with real data
- 2.1-INT-010 to 2.1-INT-011: Wind-down filtering

**File:** `tests/backend/db/test_queries.py`
- 2.1-INT-012: SQL placeholder validation
- 2.1-INT-015: UTC time operations
- 2.1-INT-016: Context manager usage

**File:** `tests/integration/test_api_integration.py`
- 2.1-INT-001 to 2.1-INT-002: GET /api/videos contract
- 2.1-INT-007: Randomness validation
- 2.1-INT-008 to 2.1-INT-009: State management
- 2.1-INT-013 to 2.1-INT-014: Error handling

---

### Frontend Tests

**File:** `frontend/src/child/grid.test.js`
- 2.1-UNIT-001 to 2.1-UNIT-004: Count validation
- 2.1-UNIT-010: XSS prevention with textContent

---

### E2E Tests

**File:** `tests/e2e/specs/child-grid.spec.js`
- All 2.1-E2E-001 to 2.1-E2E-021 scenarios
- Group by viewport: Desktop (1920x1080), Tablet (1024x768)
- Use Playwright browser automation

---

## Coverage Goals

| Component                     | Target Coverage | Justification                                    |
| ----------------------------- | --------------- | ------------------------------------------------ |
| `viewing_session.py`          | ≥90%            | Core business logic, safety-critical             |
| `db/queries.py` (video funcs) | ≥85%            | Database layer with TIER 1 rules                 |
| `routes.py` (GET /api/videos) | ≥85%            | API endpoint with error handling                 |
| `grid.js` (frontend)          | ≥70%            | UI logic, acceptable for view layer              |
| `grid.html` (template)        | Manual review   | Visual validation via E2E tests                  |
| `main.css` (grid styles)      | Visual tests    | CSS validated via E2E screenshot comparison      |

---

## Test Data Requirements

### Database Fixtures

1. **Videos Table:**
   - 20+ videos (mix of available/unavailable)
   - 3+ banned videos
   - Various durations (2-15 minutes)
   - Multiple channels

2. **Watch History:**
   - Recent watches (last 7 days) for favorites pool
   - Older watches (>7 days) for novelty pool
   - Mix of manual_play/grace_play flags for TIER 1 testing

3. **Settings:**
   - `daily_limit_minutes` = 30
   - `grid_size` variations (9, 12, 15)
   - `audio_enabled` = true

4. **Banned Videos:**
   - 3+ banned video_ids to test filtering

---

## Known Test Limitations

1. **Weighted Random Testing:** Impossible to test exact distribution (60-80% novelty) without statistical analysis over hundreds of runs. We validate pool separation logic instead.

2. **CSS Visual Validation:** Playwright screenshots provide snapshots but may have pixel differences across environments. Use threshold-based comparison.

3. **Responsive Breakpoints:** E2E tests validate specific viewports (1920x1080, 1024x768) but not all intermediate sizes.

4. **Performance Testing:** Not included in this story. Benchmark tests exist in Story 1.X infrastructure but should be run separately.

---

## Success Criteria

Before marking Story 2.1 as complete:

- [ ] All 12 P0 (TIER 1) tests pass 100%
- [ ] All 29 P1 tests pass
- [ ] Backend coverage: `viewing_session.py` ≥90%, `queries.py` ≥85%
- [ ] Frontend coverage: `grid.js` ≥70%
- [ ] No linting errors (black, ruff, eslint)
- [ ] Manual verification: Grid visually matches design mockups
- [ ] QA gate review: PASS decision

---

## References

- **Story File:** `docs/stories/2.1.child-friendly-video-grid.md`
- **Coding Standards:** `docs/architecture/coding-standards.md` (TIER 1/2/3 rules)
- **Test Strategy:** `docs/architecture/test-strategy-and-standards.md`
- **API Specification:** `docs/architecture/api-specification.md#get-apivideos`
- **Test Levels Framework:** `.bmad-core/data/test-levels-framework.md`
- **Test Priorities Matrix:** `.bmad-core/data/test-priorities-matrix.md`

---

## Change Log

| Date       | Version | Description                     | Author                  |
| ---------- | ------- | ------------------------------- | ----------------------- |
| 2025-10-22 | 1.0     | Initial test design             | Quinn (Test Architect)  |

---

## Notes for Developers

1. **TIER 1 tests are non-negotiable** - Must pass before any deployment.
2. **Run safety tests early** - Use `pytest -m tier1 -v` to fail fast.
3. **50-iteration tests** - Banned/unavailable video tests run 50 times to catch randomness edge cases.
4. **XSS prevention** - Always use `textContent`, never `innerHTML` for user data.
5. **UTC everywhere** - Use `datetime.now(timezone.utc)` consistently.
6. **SQL placeholders** - Never use f-strings or string formatting in SQL queries.

---

**End of Test Design Document**
