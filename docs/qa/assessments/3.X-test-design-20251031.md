# Test Design: Story 3.X - Admin Help & Documentation

**Date:** 2025-10-31
**Designer:** Quinn (Test Architect)
**Story ID:** 3.X
**Story Title:** Admin Help & Documentation

## Test Strategy Overview

This test design focuses on comprehensive validation of help system components with strong emphasis on **WCAG 2.1 Level AA accessibility compliance**. Given the child-focused nature of the application and parent-facing admin interface, accessibility is treated as a P0 requirement.

### Summary Statistics

- **Total test scenarios:** 37 automated + 4 manual = 41 total
- **Unit tests:** 13 (35%)
- **Integration tests:** 11 (30%)
- **E2E tests:** 13 (35%)

### Priority Distribution

- **P0 (Critical):** 10 scenarios (27%) - Accessibility compliance, keyboard navigation, ARIA
- **P1 (High):** 19 scenarios (51%) - Core component functionality, help display
- **P2 (Medium):** 8 scenarios (22%) - Secondary features, documentation
- **P3 (Low):** 0 automated scenarios (0%) - 4 manual content review scenarios

### Test Level Rationale

**High E2E percentage justified by:**
- WCAG 2.1 AA compliance requires end-to-end validation (cannot be unit tested)
- Keyboard navigation testing requires real browser environment
- Screen reader compatibility testing requires assistive technology
- Color contrast validation requires rendered pixels
- User interaction flows (Tab â†’ Enter â†’ ESC) need full integration

**Unit tests focused on:**
- Pure JavaScript logic in help.js module (createTooltip, createFAQ)
- Version display function
- Component behavior in isolation

**Integration tests cover:**
- Template rendering with help components
- Vite build configuration
- Help text associations with form inputs

## Test Scenarios by Acceptance Criteria

### AC1: Help text appears on each admin page

**Requirement:** Help text on channels, history, settings, dashboard pages explaining functionality with proper ARIA associations.

| ID | Level | Priority | Test Scenario | Justification |
|----|-------|----------|---------------|---------------|
| 3.X-INT-001 | Integration | P1 | Verify help text renders on channels.html with correct Norwegian content | Template integration validation, frequently used page |
| 3.X-INT-002 | Integration | P1 | Verify help text renders on history.html with correct Norwegian content | Template integration validation, frequently used page |
| 3.X-INT-003 | Integration | P1 | Verify help text renders on settings.html with correct Norwegian content | Template integration validation, frequently used page |
| 3.X-INT-004 | Integration | P1 | Verify help text renders on dashboard.html with correct Norwegian content | Template integration validation, frequently used page |
| 3.X-E2E-001 | E2E | P0 | Verify help text has correct ARIA associations (aria-describedby) on all pages | WCAG 2.1 AA requirement for accessibility |
| 3.X-E2E-002 | E2E | P0 | Verify screen readers announce help text for form inputs | WCAG 2.1 AA requirement for assistive technology |
| 3.X-E2E-003 | E2E | P0 | Verify help text color contrast meets WCAG AA minimum (4.5:1) | WCAG 2.1 AA requirement for color contrast |

**Coverage:** 7 scenarios (4 integration P1, 3 E2E P0)

---

### AC2: Getting Started guide created in Norwegian

**Requirement:** docs/getting-started-no.md with 7 sections, Norwegian language, 500-800 words, proper Markdown.

| ID | Level | Priority | Test Scenario | Justification |
|----|-------|----------|---------------|---------------|
| 3.X-INT-005 | Integration | P2 | Verify getting-started-no.md file exists at correct path | File presence validation |
| 3.X-UNIT-001 | Unit | P2 | Validate Markdown structure has all 7 required sections | Structure validation via parsing |
| 3.X-UNIT-002 | Unit | P2 | Validate heading hierarchy (h1 â†’ h2 â†’ h3) follows accessibility standards | WCAG guideline for semantic structure |
| 3.X-MANUAL-001 | Manual | P3 | Review Norwegian language quality and tone (friendly, non-technical) | Content quality review - manual only |
| 3.X-MANUAL-002 | Manual | P3 | Verify word count within 500-800 range | Simple validation, can be manual |

**Coverage:** 5 scenarios (1 integration P2, 2 unit P2, 2 manual P3)

---

### AC3: FAQ section added to admin interface

**Requirement:** Collapsible accordion with 7 Norwegian questions, keyboard accessible, proper ARIA.

| ID | Level | Priority | Test Scenario | Justification |
|----|-------|----------|---------------|---------------|
| 3.X-UNIT-003 | Unit | P1 | Test createFAQ() renders 7 question buttons with correct Norwegian text | Core component logic validation |
| 3.X-UNIT-004 | Unit | P1 | Test createFAQ() sets correct ARIA attributes (aria-expanded, aria-controls) | Component behavior - ARIA setup |
| 3.X-UNIT-005 | Unit | P1 | Test createFAQ() toggles answer visibility on click | Core interactive behavior |
| 3.X-UNIT-006 | Unit | P1 | Test createFAQ() manages hidden attribute on answer divs | DOM manipulation logic |
| 3.X-INT-006 | Integration | P1 | Verify FAQ section renders in dashboard.html with all 7 questions | Template integration validation |
| 3.X-E2E-004 | E2E | P0 | Verify FAQ questions are keyboard accessible (Tab to navigate) | WCAG 2.1 AA keyboard accessibility requirement |
| 3.X-E2E-005 | E2E | P0 | Verify Enter/Space keys expand/collapse FAQ answers | WCAG 2.1 AA keyboard operation requirement |
| 3.X-E2E-006 | E2E | P0 | Verify screen reader announces expanded/collapsed state changes | WCAG 2.1 AA assistive technology requirement |
| 3.X-E2E-007 | E2E | P0 | Run axe-core accessibility scan on FAQ section (WCAG 2.1 AA) | Automated accessibility validation |

**Coverage:** 9 scenarios (4 unit P1, 1 integration P1, 4 E2E P0)

---

### AC4: Tooltips on complex settings (keyboard accessible)

**Requirement:** Tooltips on 3 settings (daily limit, grid size, audio), click/keyboard activated, ESC closes, proper ARIA.

| ID | Level | Priority | Test Scenario | Justification |
|----|-------|----------|---------------|---------------|
| 3.X-UNIT-007 | Unit | P1 | Test createTooltip() creates trigger button with correct text and ARIA attributes | Core component logic validation |
| 3.X-UNIT-008 | Unit | P1 | Test createTooltip() creates tooltip element with role="tooltip" and correct ID | Component structure validation |
| 3.X-UNIT-009 | Unit | P1 | Test createTooltip() toggles tooltip visibility on click | Core interactive behavior |
| 3.X-UNIT-010 | Unit | P1 | Test createTooltip() closes tooltip on ESC key press | Keyboard interaction logic |
| 3.X-UNIT-011 | Unit | P1 | Test createTooltip() returns focus to trigger after ESC close | Focus management logic |
| 3.X-INT-007 | Integration | P1 | Verify 3 tooltips render in settings.html (daily limit, grid size, audio) | Template integration validation |
| 3.X-E2E-008 | E2E | P0 | Verify tooltips are keyboard accessible (Tab to trigger, Enter/Space to open) | WCAG 2.1 AA keyboard accessibility requirement |
| 3.X-E2E-009 | E2E | P0 | Verify ESC key closes tooltip and returns focus to trigger | WCAG 2.1 AA keyboard operation requirement |
| 3.X-E2E-010 | E2E | P0 | Verify tooltip color contrast meets WCAG AA (4.5:1 for text) | WCAG 2.1 AA color contrast requirement |

**Coverage:** 9 scenarios (5 unit P1, 1 integration P1, 3 E2E P0)

**Note:** Tooltips are NOT hover-only (accessibility anti-pattern). Click/keyboard activation is a TIER 1 requirement for WCAG compliance.

---

### AC5: Link to full documentation from admin dashboard

**Requirement:** Link with text "ðŸ“– Kom i gang", accessible, opens documentation or displays local file message.

| ID | Level | Priority | Test Scenario | Justification |
|----|-------|----------|---------------|---------------|
| 3.X-INT-008 | Integration | P2 | Verify documentation link renders in dashboard.html with correct Norwegian text | Template integration validation |
| 3.X-E2E-011 | E2E | P2 | Verify link is keyboard accessible (Tab to focus, Enter to activate) | Basic keyboard accessibility |
| 3.X-E2E-012 | E2E | P2 | Verify link has descriptive text (not "click here") and proper ARIA label if external | Accessibility best practice |

**Coverage:** 3 scenarios (1 integration P2, 2 E2E P2)

---

### AC7: Version number displayed in admin footer

**Requirement:** Version from package.json injected via Vite, displayed as "Versjon X.Y.Z" in footer, screen reader accessible.

| ID | Level | Priority | Test Scenario | Justification |
|----|-------|----------|---------------|---------------|
| 3.X-UNIT-012 | Unit | P1 | Test displayVersion() function reads import.meta.env.VITE_APP_VERSION correctly | Pure function logic validation |
| 3.X-UNIT-013 | Unit | P1 | Test displayVersion() formats version string as "Versjon X.Y.Z" (Norwegian) | String formatting logic |
| 3.X-INT-009 | Integration | P1 | Verify vite.config.js injects version from package.json at build time | Build configuration validation |
| 3.X-INT-010 | Integration | P1 | Verify version displays in base.html footer on all admin pages | Template inheritance validation |
| 3.X-E2E-013 | E2E | P2 | Verify screen reader can read version text in footer | Basic accessibility validation |

**Coverage:** 5 scenarios (2 unit P1, 2 integration P1, 1 E2E P2)

---

### AC8: Help text explains key concepts

**Requirement:** 6 key concepts defined in Norwegian, integrated into relevant pages, consistent terminology.

| ID | Level | Priority | Test Scenario | Justification |
|----|-------|----------|---------------|---------------|
| 3.X-INT-011 | Integration | P2 | Verify all 6 key concepts appear in help text on relevant admin pages | Content presence validation |
| 3.X-MANUAL-003 | Manual | P2 | Review Norwegian definitions for accuracy and clarity (1-2 sentences each) | Content quality review |
| 3.X-MANUAL-004 | Manual | P2 | Verify consistent terminology usage across all admin pages | Consistency validation |

**Coverage:** 3 scenarios (1 integration P2, 2 manual P2)

---

## Test Scenario Summary Table

### By Acceptance Criteria

| AC | Description | Unit | Integration | E2E | Manual | Total |
|----|-------------|------|-------------|-----|--------|-------|
| AC1 | Help text on pages | 0 | 4 | 3 | 0 | 7 |
| AC2 | Getting Started guide | 2 | 1 | 0 | 2 | 5 |
| AC3 | FAQ accordion | 4 | 1 | 4 | 0 | 9 |
| AC4 | Tooltips | 5 | 1 | 3 | 0 | 9 |
| AC5 | Documentation link | 0 | 1 | 2 | 0 | 3 |
| AC7 | Version display | 2 | 2 | 1 | 0 | 5 |
| AC8 | Key concepts | 0 | 1 | 0 | 2 | 3 |
| **TOTAL** | | **13** | **11** | **13** | **4** | **41** |

**Revised totals excluding manual tests:**
- **Automated tests:** 37 (Unit: 13, Integration: 11, E2E: 13)
- **Manual tests:** 4 (content quality reviews)

### By Priority

| Priority | Unit | Integration | E2E | Total | % of Total |
|----------|------|-------------|-----|-------|-----------|
| P0 | 0 | 0 | 10 | 10 | 27% |
| P1 | 11 | 8 | 0 | 19 | 51% |
| P2 | 2 | 3 | 3 | 8 | 22% |
| P3 | 0 | 0 | 0 | 0 | 0% |
| **TOTAL** | **13** | **11** | **13** | **37** | **100%** |

*Note: Manual tests (4 scenarios, all P2-P3) not included in automated test counts*

---

## Risk Coverage

### Identified Risks and Mitigation

| Risk ID | Risk Description | Probability | Impact | Mitigated By |
|---------|-----------------|-------------|--------|--------------|
| RISK-3X-001 | Non-compliant accessibility breaks screen reader usage for parents with disabilities | Medium | High | 3.X-E2E-001, 3.X-E2E-002, 3.X-E2E-004-010 (all P0) |
| RISK-3X-002 | Poor keyboard navigation prevents keyboard-only users from accessing help | Medium | High | 3.X-E2E-004, 3.X-E2E-005, 3.X-E2E-008, 3.X-E2E-009 (all P0) |
| RISK-3X-003 | Insufficient color contrast makes help text unreadable | Low | Medium | 3.X-E2E-003, 3.X-E2E-010 (both P0) |
| RISK-3X-004 | Help component bugs prevent parents from understanding features | Medium | Medium | 3.X-UNIT-003-011 (all P1) |
| RISK-3X-005 | Norwegian language errors confuse Norwegian-speaking parents | Low | Low | 3.X-MANUAL-001, 3.X-MANUAL-003 (manual review) |

### Coverage Confidence

- **P0 Risks:** 100% coverage (all accessibility risks have automated E2E tests)
- **P1 Risks:** 100% coverage (all core component logic has unit tests)
- **P2 Risks:** Adequate coverage (integration tests + manual review)

---

## Recommended Execution Order

### Phase 1: Fast Feedback (Unit Tests)
Execute first for rapid feedback on component logic:

1. 3.X-UNIT-003 through 3.X-UNIT-011 (createFAQ and createTooltip logic)
2. 3.X-UNIT-001, 3.X-UNIT-002 (Getting Started structure validation)
3. 3.X-UNIT-012, 3.X-UNIT-013 (Version display logic)

**Expected duration:** 5-10 seconds
**Fail fast:** Blocks E2E if component logic broken

### Phase 2: Integration Validation
Execute after unit tests pass:

1. 3.X-INT-001 through 3.X-INT-004 (Help text rendering on all pages - P1)
2. 3.X-INT-006, 3.X-INT-007 (FAQ and tooltip template integration - P1)
3. 3.X-INT-009, 3.X-INT-010 (Version injection and display - P1)
4. 3.X-INT-005, 3.X-INT-008, 3.X-INT-011 (Documentation and key concepts - P2)

**Expected duration:** 30-60 seconds
**Validates:** Template integration, build configuration

### Phase 3: Critical Accessibility (P0 E2E)
Execute after integration tests pass:

1. 3.X-E2E-001 through 3.X-E2E-010 (All P0 accessibility tests)

**Expected duration:** 5-8 minutes
**Critical path:** WCAG 2.1 AA compliance validation

### Phase 4: Secondary Features (P2 E2E)
Execute if time permits:

1. 3.X-E2E-011, 3.X-E2E-012 (Documentation link - P2)
2. 3.X-E2E-013 (Version screen reader - P2)

**Expected duration:** 1-2 minutes

### Phase 5: Manual Review
Conduct before story completion:

1. 3.X-MANUAL-001, 3.X-MANUAL-002 (Getting Started content)
2. 3.X-MANUAL-003, 3.X-MANUAL-004 (Key concepts quality)

**Expected duration:** 30-60 minutes human time

---

## Coverage Validation

### âœ… Coverage Completeness Checklist

- [x] **AC1:** 7 scenarios covering help text display, ARIA, screen readers, color contrast
- [x] **AC2:** 5 scenarios covering file structure, Markdown validation, content review
- [x] **AC3:** 9 scenarios covering createFAQ logic, template integration, keyboard accessibility
- [x] **AC4:** 9 scenarios covering createTooltip logic, template integration, keyboard accessibility
- [x] **AC5:** 3 scenarios covering documentation link rendering and accessibility
- [x] **AC7:** 5 scenarios covering version injection, display, and screen reader support
- [x] **AC8:** 3 scenarios covering key concepts display and content quality
- [x] **All acceptance criteria have test coverage** âœ…
- [x] **All P0 accessibility requirements covered by E2E tests** âœ…
- [x] **No duplicate coverage across test levels** âœ…
- [x] **Critical component logic covered by unit tests** âœ…

### Coverage Gaps

**None identified.** All acceptance criteria have appropriate test coverage at correct levels.

### Test Efficiency Analysis

**Avoided over-testing by:**
- Not writing E2E tests for pure component logic (tested at unit level)
- Not writing integration tests for build-time behavior (vite.config.js - simple read)
- Relegating content quality to manual review (not automatable)

**Appropriate E2E usage:**
- All E2E tests validate WCAG compliance (cannot be unit tested)
- No E2E tests for business logic (covered by unit tests)
- E2E tests focus on user interaction and assistive technology

---

## Test File Organization

### Frontend Unit Tests

**Location:** `frontend/src/shared/help.test.js` (collocated with source)

**Framework:** Vitest 3.2.4 with happy-dom 19.0.2

**Test structure:**
```javascript
describe('createTooltip', () => {
  // 3.X-UNIT-007 through 3.X-UNIT-011
});

describe('createFAQ', () => {
  // 3.X-UNIT-003 through 3.X-UNIT-006
});
```

**Location:** `frontend/src/shared/version.test.js`

**Test structure:**
```javascript
describe('displayVersion', () => {
  // 3.X-UNIT-012, 3.X-UNIT-013
});
```

### Integration Tests

**Location:** `tests/integration/test_admin_help_integration.py`

**Framework:** pytest 8.4.2

**Test structure:**
```python
class TestHelpTextIntegration:
    # 3.X-INT-001 through 3.X-INT-004

class TestFAQIntegration:
    # 3.X-INT-006

class TestTooltipIntegration:
    # 3.X-INT-007

class TestVersionIntegration:
    # 3.X-INT-009, 3.X-INT-010
```

### E2E Accessibility Tests

**Location:** `tests/e2e/specs/admin-help-accessibility.spec.js`

**Framework:** Playwright 1.40.0 with @axe-core/playwright

**Test structure:**
```javascript
test.describe('Help Text Accessibility', () => {
  // 3.X-E2E-001, 3.X-E2E-002, 3.X-E2E-003
});

test.describe('FAQ Keyboard Navigation', () => {
  // 3.X-E2E-004, 3.X-E2E-005, 3.X-E2E-006, 3.X-E2E-007
});

test.describe('Tooltip Keyboard Navigation', () => {
  // 3.X-E2E-008, 3.X-E2E-009, 3.X-E2E-010
});

test.describe('Documentation Link Accessibility', () => {
  // 3.X-E2E-011, 3.X-E2E-012
});
```

---

## Test Data Requirements

### Static Test Data

- **Norwegian text samples** for language validation
- **WCAG AA color pairs** for contrast testing (4.5:1 minimum)
- **Package.json version** for version injection testing

### Dynamic Test Data

- **FAQ questions array** (7 questions in Norwegian)
- **Tooltip content** (3 tooltips for settings page)
- **Key concepts** (6 definitions in Norwegian)

### Test Fixtures

```javascript
// frontend/src/shared/help.test.js
const mockFAQData = [
  {
    question: "Hvordan legger jeg til en ny YouTube-kanal?",
    answer: "GÃ¥ til 'Kanaler'-fanen..."
  },
  // ... 6 more questions
];

const mockTooltipContent = {
  dailyLimit: "Grensen tilbakestilles hver natt kl. 00:00 UTC...",
  gridSize: "FÃ¦rre videoer gir stÃ¸rre bilder...",
  audio: "Lydvarsler er enkle 'pling'-lyder..."
};
```

---

## Key Testing Principles Applied

### 1. Shift Left
âœ… **Unit tests for component logic** (createTooltip, createFAQ) catch bugs early
âœ… **Integration tests for template rendering** before E2E
âœ… **E2E only for accessibility validation** (cannot be unit tested)

### 2. Risk-Based Testing
âœ… **P0 accessibility tests** (38% of total) reflect high risk of WCAG non-compliance
âœ… **P1 component tests** (31% of total) for frequently used help features
âœ… **P2/P3 for content quality** (manual review acceptable)

### 3. Efficient Coverage
âœ… **No duplicate testing** across levels (unit = logic, integration = templates, E2E = accessibility)
âœ… **Appropriate test levels** (not testing component logic in E2E)
âœ… **Manual review for content** (automating content quality is inefficient)

### 4. Maintainability
âœ… **Collocated frontend tests** (help.test.js with help.js)
âœ… **Clear test IDs** (3.X-UNIT-001, 3.X-E2E-001)
âœ… **Atomic scenarios** (each test validates one thing)

### 5. Fast Feedback
âœ… **Unit tests run first** (5-10 seconds)
âœ… **P0 tests fail fast** (block deployment immediately)
âœ… **E2E tests run last** (5-8 minutes for accessibility)

---

## Success Criteria for Test Design

- [x] Every AC has at least one test âœ…
- [x] Test levels are appropriate (not over-testing) âœ…
- [x] No duplicate coverage across levels âœ…
- [x] Priorities align with business risk âœ…
- [x] Test IDs follow naming convention (3.X-{LEVEL}-{SEQ}) âœ…
- [x] Scenarios are atomic and independent âœ…
- [x] Accessibility compliance has comprehensive P0 coverage âœ…
- [x] Component logic tested at unit level âœ…
- [x] Integration tests validate template rendering âœ…
- [x] E2E tests focus on WCAG validation âœ…

---

## Notes for Implementation

### Testing Tool Requirements

**Frontend:**
- Vitest 3.2.4 (already installed)
- happy-dom 19.0.2 (already installed)
- @vitest/coverage-v8 3.2.4 (already installed)

**E2E:**
- Playwright 1.40.0 (already installed)
- @axe-core/playwright (may need installation)

**Backend:**
- pytest 8.4.2 (already installed)
- pytest-cov 7.0.0 (already installed)

### Accessibility Testing Setup

```bash
# Install axe-core Playwright integration (if not already installed)
npm install --save-dev @axe-core/playwright
```

### Running Tests

```bash
# Frontend unit tests (fast feedback)
npm test

# Frontend unit tests with coverage
npm run test:coverage

# E2E accessibility tests
npx playwright test admin-help-accessibility.spec.js

# Backend integration tests
uv run pytest tests/integration/test_admin_help_integration.py -v

# Run all P0 tests only (CI pipeline)
npm test && npx playwright test --grep "@P0"
```

### Coverage Targets

- **Frontend unit tests:** 70% coverage for help.js module (acceptable for UI components)
- **Integration tests:** Focus on template rendering, not coverage percentage
- **E2E tests:** 100% of P0 accessibility requirements must pass

---

## Revision History

| Date | Version | Changes | Author |
|------|---------|---------|--------|
| 2025-10-31 | 1.0 | Initial test design for Story 3.X | Quinn (Test Architect) |
