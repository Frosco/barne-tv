{% extends "base.html" %}

{% block title %}Innstillinger - Admin{% endblock %}

{% block content %}
<div class="admin-container">
  <header class="admin-header">
    <h1 class="admin-title">Innstillinger</h1>
    <p class="admin-subtitle">Konfigurer daglige grenser og innstillinger</p>
  </header>

  <div class="actions-row">
    <a href="/admin/dashboard" class="btn btn-secondary">Tilbake til dashboard</a>
  </div>

  <!-- Settings form -->
  <section class="settings-section">
    <form id="settings-form" class="settings-form">

      <!-- Daily limit -->
      <div class="form-group">
        <label for="daily-limit" class="form-label">Daglig grense (minutter)</label>
        <input
          type="number"
          id="daily-limit"
          name="daily_limit_minutes"
          class="form-input"
          min="5"
          max="180"
          step="5"
          aria-describedby="daily-limit-help"
          required
        />
        <span class="help-text" id="daily-limit-help">
          <strong>Daglig grense:</strong> Tidsbegrensning for hvor lenge barnet kan se videoer hver dag. Grensen tilbakestilles ved midnatt (UTC). Når det er mindre enn 10 minutter igjen, går systemet over i 'avslutningsmodus' som bare viser korte videoer. Etter at grensen er nådd, får barnet velge én siste 'takkvideo' (maks 5 minutter).
        </span>
        <span class="error-text" id="daily-limit-error"></span>
      </div>

      <!-- Grid size -->
      <div class="form-group">
        <label for="grid-size" class="form-label">Antall videoer i rutenettet</label>
        <input
          type="number"
          id="grid-size"
          name="grid_size"
          class="form-input"
          min="4"
          max="15"
          aria-describedby="grid-size-help"
          required
        />
        <span class="help-text" id="grid-size-help">
          Hvor mange videoer som vises på skjermen samtidig (4-15 videoer). Færre videoer gir større bilder, flere videoer gir mer variasjon.
        </span>
        <span class="error-text" id="grid-size-error"></span>
      </div>

      <!-- Audio enabled -->
      <div class="form-group form-group-checkbox">
        <label for="audio-enabled" class="form-label">
          <input
            type="checkbox"
            id="audio-enabled"
            name="audio_enabled"
            class="form-checkbox"
            aria-describedby="audio-help"
          />
          Lydvarsler aktivert
        </label>
        <span class="help-text" id="audio-help">
          Spill av lydvarsler ved 10, 5, og 2 minutter igjen. Lydvarslene er enkle 'pling'-lyder, ikke forstyrrende alarmer.
        </span>
      </div>

      <!-- Engagement data reset (Story 4.4) -->
      <div class="form-group form-group-danger">
        <h3 class="form-section-title">Engasjementsdata</h3>
        <p class="help-text">
          Videoene vises basert på hvor mye barnet liker dem (fullføring og gjenspilling). Du kan tilbakestille disse dataene for å starte på nytt.
        </p>
        <button type="button" id="reset-engagement-btn" class="btn btn-danger">
          Tilbakestill engasjementsdata
        </button>
      </div>

      <!-- Form actions -->
      <div class="form-actions">
        <button type="submit" id="save-btn" class="btn btn-primary" disabled>
          Lagre innstillinger
        </button>
        <button type="button" id="reset-btn" class="btn btn-secondary">
          Tilbakestill til standardverdier
        </button>
      </div>

      <!-- Message display -->
      <div id="message-container" class="message-container" style="display: none;">
        <span id="message-text"></span>
      </div>
    </form>
  </section>
</div>

<script type="module">
  {% if dev_mode %}
  {# Development: Import from Vite dev server #}
  import { initSettings } from 'http://localhost:5173/src/admin/settings.js';
  {% else %}
  {# Production: Import from built assets #}
  import { initSettings } from '/static/assets/admin/settings.js';
  {% endif %}
  initSettings();
</script>

<style>
.actions-row {
  display: flex;
  justify-content: flex-start;
  margin-bottom: var(--space-lg);
}

.settings-section {
  background: white;
  padding: var(--space-xl);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
}

.settings-form {
  max-width: 600px;
}

.settings-form.loading {
  opacity: 0.6;
  pointer-events: none;
}

/* Engagement reset section (Story 4.4) */
.form-group-danger {
  margin-top: var(--space-xl);
  padding-top: var(--space-lg);
  border-top: 1px solid var(--color-gray-light);
}

.form-section-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--space-sm);
}

.btn-danger {
  background-color: var(--color-danger);
  color: white;
  border: none;
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--radius-md);
  font-size: var(--font-size-base);
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.btn-danger:hover:not(:disabled) {
  background-color: var(--color-danger-dark);
}

.btn-danger:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>
{% endblock %}
